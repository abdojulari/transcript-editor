(function(){function t(o){return function(t,e,n,i){e=w(e,i,4);var r=!I(t)&&y.keys(t),a=(r||t).length,s=0<o?0:a-1;return arguments.length<3&&(n=t[r?r[s]:s],s+=o),function(t,e,n,i,r,a){for(;0<=r&&r<a;r+=o){var s=i?i[r]:r;n=e(n,t[s],s,t)}return n}(t,e,n,r,s,a)}}function e(a){return function(t,e,n){e=b(e,n);for(var i=S(t),r=0<a?0:i-1;0<=r&&r<i;r+=a)if(e(t[r],r,t))return r;return-1}}function n(a,s,o){return function(t,e,n){var i=0,r=S(t);if("number"==typeof n)0<a?i=0<=n?n:Math.max(n+r,i):r=0<=n?Math.min(n+1,r):n+r+1;else if(o&&n&&r)return t[n=o(t,e)]===e?n:-1;if(e!=e)return 0<=(n=s(l.call(t,i,r),y.isNaN))?n+i:-1;for(n=0<a?i:r-1;0<=n&&n<r;n+=a)if(t[n]===e)return n;return-1}}function i(t,e){var n=P.length,i=t.constructor,r=y.isFunction(i)&&i.prototype||o,a="constructor";for(y.has(t,a)&&!y.contains(e,a)&&e.push(a);n--;)(a=P[n])in t&&t[a]!==r[a]&&!y.contains(e,a)&&e.push(a)}var r=this,a=r._,s=Array.prototype,o=Object.prototype,u=Function.prototype,c=s.push,l=s.slice,h=o.toString,f=o.hasOwnProperty,d=Array.isArray,p=Object.keys,v=u.bind,g=Object.create,m=function(){},y=function(t){return t instanceof y?t:this instanceof y?void(this._wrapped=t):new y(t)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=y),exports._=y):r._=y,y.VERSION="1.8.3";var w=function(r,a,t){if(void 0===a)return r;switch(null==t?3:t){case 1:return function(t){return r.call(a,t)};case 2:return function(t,e){return r.call(a,t,e)};case 3:return function(t,e,n){return r.call(a,t,e,n)};case 4:return function(t,e,n,i){return r.call(a,t,e,n,i)}}return function(){return r.apply(a,arguments)}},b=function(t,e,n){return null==t?y.identity:y.isFunction(t)?w(t,e,n):y.isObject(t)?y.matcher(t):y.property(t)};y.iteratee=function(t,e){return b(t,e,1/0)};var _=function(u,c){return function(t){var e=arguments.length;if(e<2||null==t)return t;for(var n=1;n<e;n++)for(var i=arguments[n],r=u(i),a=r.length,s=0;s<a;s++){var o=r[s];c&&void 0!==t[o]||(t[o]=i[o])}return t}},x=function(t){if(!y.isObject(t))return{};if(g)return g(t);m.prototype=t;var e=new m;return m.prototype=null,e},T=function(e){return function(t){return null==t?void 0:t[e]}},k=Math.pow(2,53)-1,S=T("length"),I=function(t){var e=S(t);return"number"==typeof e&&0<=e&&e<=k};y.each=y.forEach=function(t,e,n){var i,r;if(e=w(e,n),I(t))for(i=0,r=t.length;i<r;i++)e(t[i],i,t);else{var a=y.keys(t);for(i=0,r=a.length;i<r;i++)e(t[a[i]],a[i],t)}return t},y.map=y.collect=function(t,e,n){e=b(e,n);for(var i=!I(t)&&y.keys(t),r=(i||t).length,a=Array(r),s=0;s<r;s++){var o=i?i[s]:s;a[s]=e(t[o],o,t)}return a},y.reduce=y.foldl=y.inject=t(1),y.reduceRight=y.foldr=t(-1),y.find=y.detect=function(t,e,n){var i;return void 0!==(i=I(t)?y.findIndex(t,e,n):y.findKey(t,e,n))&&-1!==i?t[i]:void 0},y.filter=y.select=function(t,i,e){var r=[];return i=b(i,e),y.each(t,function(t,e,n){i(t,e,n)&&r.push(t)}),r},y.reject=function(t,e,n){return y.filter(t,y.negate(b(e)),n)},y.every=y.all=function(t,e,n){e=b(e,n);for(var i=!I(t)&&y.keys(t),r=(i||t).length,a=0;a<r;a++){var s=i?i[a]:a;if(!e(t[s],s,t))return!1}return!0},y.some=y.any=function(t,e,n){e=b(e,n);for(var i=!I(t)&&y.keys(t),r=(i||t).length,a=0;a<r;a++){var s=i?i[a]:a;if(e(t[s],s,t))return!0}return!1},y.contains=y.includes=y.include=function(t,e,n,i){return I(t)||(t=y.values(t)),("number"!=typeof n||i)&&(n=0),0<=y.indexOf(t,e,n)},y.invoke=function(t,n){var i=l.call(arguments,2),r=y.isFunction(n);return y.map(t,function(t){var e=r?n:t[n];return null==e?e:e.apply(t,i)})},y.pluck=function(t,e){return y.map(t,y.property(e))},y.where=function(t,e){return y.filter(t,y.matcher(e))},y.findWhere=function(t,e){return y.find(t,y.matcher(e))},y.max=function(t,i,e){var n,r,a=-1/0,s=-1/0;if(null==i&&null!=t)for(var o=0,u=(t=I(t)?t:y.values(t)).length;o<u;o++)n=t[o],a<n&&(a=n);else i=b(i,e),y.each(t,function(t,e,n){r=i(t,e,n),(s<r||r===-1/0&&a===-1/0)&&(a=t,s=r)});return a},y.min=function(t,i,e){var n,r,a=1/0,s=1/0;if(null==i&&null!=t)for(var o=0,u=(t=I(t)?t:y.values(t)).length;o<u;o++)(n=t[o])<a&&(a=n);else i=b(i,e),y.each(t,function(t,e,n){((r=i(t,e,n))<s||1/0===r&&1/0===a)&&(a=t,s=r)});return a},y.shuffle=function(t){for(var e,n=I(t)?t:y.values(t),i=n.length,r=Array(i),a=0;a<i;a++)(e=y.random(0,a))!==a&&(r[a]=r[e]),r[e]=n[a];return r},y.sample=function(t,e,n){return null==e||n?(I(t)||(t=y.values(t)),t[y.random(t.length-1)]):y.shuffle(t).slice(0,Math.max(0,e))},y.sortBy=function(t,i,e){return i=b(i,e),y.pluck(y.map(t,function(t,e,n){return{value:t,index:e,criteria:i(t,e,n)}}).sort(function(t,e){var n=t.criteria,i=e.criteria;if(n!==i){if(i<n||void 0===n)return 1;if(n<i||void 0===i)return-1}return t.index-e.index}),"value")};var $=function(s){return function(i,r,t){var a={};return r=b(r,t),y.each(i,function(t,e){var n=r(t,e,i);s(a,t,n)}),a}};y.groupBy=$(function(t,e,n){y.has(t,n)?t[n].push(e):t[n]=[e]}),y.indexBy=$(function(t,e,n){t[n]=e}),y.countBy=$(function(t,e,n){y.has(t,n)?t[n]++:t[n]=1}),y.toArray=function(t){return t?y.isArray(t)?l.call(t):I(t)?y.map(t,y.identity):y.values(t):[]},y.size=function(t){return null==t?0:I(t)?t.length:y.keys(t).length},y.partition=function(t,i,e){i=b(i,e);var r=[],a=[];return y.each(t,function(t,e,n){(i(t,e,n)?r:a).push(t)}),[r,a]},y.first=y.head=y.take=function(t,e,n){return null==t?void 0:null==e||n?t[0]:y.initial(t,t.length-e)},y.initial=function(t,e,n){return l.call(t,0,Math.max(0,t.length-(null==e||n?1:e)))},y.last=function(t,e,n){return null==t?void 0:null==e||n?t[t.length-1]:y.rest(t,Math.max(0,t.length-e))},y.rest=y.tail=y.drop=function(t,e,n){return l.call(t,null==e||n?1:e)},y.compact=function(t){return y.filter(t,y.identity)};var E=function(t,e,n,i){for(var r=[],a=0,s=i||0,o=S(t);s<o;s++){var u=t[s];if(I(u)&&(y.isArray(u)||y.isArguments(u))){e||(u=E(u,e,n));var c=0,l=u.length;for(r.length+=l;c<l;)r[a++]=u[c++]}else n||(r[a++]=u)}return r};y.flatten=function(t,e){return E(t,e,!1)},y.without=function(t){return y.difference(t,l.call(arguments,1))},y.uniq=y.unique=function(t,e,n,i){y.isBoolean(e)||(i=n,n=e,e=!1),null!=n&&(n=b(n,i));for(var r=[],a=[],s=0,o=S(t);s<o;s++){var u=t[s],c=n?n(u,s,t):u;e?(s&&a===c||r.push(u),a=c):n?y.contains(a,c)||(a.push(c),r.push(u)):y.contains(r,u)||r.push(u)}return r},y.union=function(){return y.uniq(E(arguments,!0,!0))},y.intersection=function(t){for(var e=[],n=arguments.length,i=0,r=S(t);i<r;i++){var a=t[i];if(!y.contains(e,a)){for(var s=1;s<n&&y.contains(arguments[s],a);s++);s===n&&e.push(a)}}return e},y.difference=function(t){var e=E(arguments,!0,!0,1);return y.filter(t,function(t){return!y.contains(e,t)})},y.zip=function(){return y.unzip(arguments)},y.unzip=function(t){for(var e=t&&y.max(t,S).length||0,n=Array(e),i=0;i<e;i++)n[i]=y.pluck(t,i);return n},y.object=function(t,e){for(var n={},i=0,r=S(t);i<r;i++)e?n[t[i]]=e[i]:n[t[i][0]]=t[i][1];return n},y.findIndex=e(1),y.findLastIndex=e(-1),y.sortedIndex=function(t,e,n,i){for(var r=(n=b(n,i,1))(e),a=0,s=S(t);a<s;){var o=Math.floor((a+s)/2);n(t[o])<r?a=o+1:s=o}return a},y.indexOf=n(1,y.findIndex,y.sortedIndex),y.lastIndexOf=n(-1,y.findLastIndex),y.range=function(t,e,n){null==e&&(e=t||0,t=0),n=n||1;for(var i=Math.max(Math.ceil((e-t)/n),0),r=Array(i),a=0;a<i;a++,t+=n)r[a]=t;return r};var A=function(t,e,n,i,r){if(!(i instanceof e))return t.apply(n,r);var a=x(t.prototype),s=t.apply(a,r);return y.isObject(s)?s:a};y.bind=function(t,e){if(v&&t.bind===v)return v.apply(t,l.call(arguments,1));if(!y.isFunction(t))throw new TypeError("Bind must be called on a function");var n=l.call(arguments,2),i=function(){return A(t,i,e,this,n.concat(l.call(arguments)))};return i},y.partial=function(r){var a=l.call(arguments,1),s=function(){for(var t=0,e=a.length,n=Array(e),i=0;i<e;i++)n[i]=a[i]===y?arguments[t++]:a[i];for(;t<arguments.length;)n.push(arguments[t++]);return A(r,s,this,this,n)};return s},y.bindAll=function(t){var e,n,i=arguments.length;if(i<=1)throw new Error("bindAll must be passed function names");for(e=1;e<i;e++)t[n=arguments[e]]=y.bind(t[n],t);return t},y.memoize=function(i,r){var a=function(t){var e=a.cache,n=""+(r?r.apply(this,arguments):t);return y.has(e,n)||(e[n]=i.apply(this,arguments)),e[n]};return a.cache={},a},y.delay=function(t,e){var n=l.call(arguments,2);return setTimeout(function(){return t.apply(null,n)},e)},y.defer=y.partial(y.delay,y,1),y.throttle=function(n,i,r){var a,s,o,u=null,c=0;r||(r={});var l=function(){c=!1===r.leading?0:y.now(),u=null,o=n.apply(a,s),u||(a=s=null)};return function(){var t=y.now();c||!1!==r.leading||(c=t);var e=i-(t-c);return a=this,s=arguments,e<=0||i<e?(u&&(clearTimeout(u),u=null),c=t,o=n.apply(a,s),u||(a=s=null)):u||!1===r.trailing||(u=setTimeout(l,e)),o}},y.debounce=function(e,n,i){var r,a,s,o,u,c=function(){var t=y.now()-o;t<n&&0<=t?r=setTimeout(c,n-t):(r=null,i||(u=e.apply(s,a),r||(s=a=null)))};return function(){s=this,a=arguments,o=y.now();var t=i&&!r;return r||(r=setTimeout(c,n)),t&&(u=e.apply(s,a),s=a=null),u}},y.wrap=function(t,e){return y.partial(e,t)},y.negate=function(t){return function(){return!t.apply(this,arguments)}},y.compose=function(){var n=arguments,i=n.length-1;return function(){for(var t=i,e=n[i].apply(this,arguments);t--;)e=n[t].call(this,e);return e}},y.after=function(t,e){return function(){return--t<1?e.apply(this,arguments):void 0}},y.before=function(t,e){var n;return function(){return 0<--t&&(n=e.apply(this,arguments)),t<=1&&(e=null),n}},y.once=y.partial(y.before,2);var j=!{toString:null}.propertyIsEnumerable("toString"),P=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];y.keys=function(t){if(!y.isObject(t))return[];if(p)return p(t);var e=[];for(var n in t)y.has(t,n)&&e.push(n);return j&&i(t,e),e},y.allKeys=function(t){if(!y.isObject(t))return[];var e=[];for(var n in t)e.push(n);return j&&i(t,e),e},y.values=function(t){for(var e=y.keys(t),n=e.length,i=Array(n),r=0;r<n;r++)i[r]=t[e[r]];return i},y.mapObject=function(t,e,n){e=b(e,n);for(var i,r=y.keys(t),a=r.length,s={},o=0;o<a;o++)s[i=r[o]]=e(t[i],i,t);return s},y.pairs=function(t){for(var e=y.keys(t),n=e.length,i=Array(n),r=0;r<n;r++)i[r]=[e[r],t[e[r]]];return i},y.invert=function(t){for(var e={},n=y.keys(t),i=0,r=n.length;i<r;i++)e[t[n[i]]]=n[i];return e},y.functions=y.methods=function(t){var e=[];for(var n in t)y.isFunction(t[n])&&e.push(n);return e.sort()},y.extend=_(y.allKeys),y.extendOwn=y.assign=_(y.keys),y.findKey=function(t,e,n){e=b(e,n);for(var i,r=y.keys(t),a=0,s=r.length;a<s;a++)if(e(t[i=r[a]],i,t))return i},y.pick=function(t,e,n){var i,r,a={},s=t;if(null==s)return a;y.isFunction(e)?(r=y.allKeys(s),i=w(e,n)):(r=E(arguments,!1,!1,1),i=function(t,e,n){return e in n},s=Object(s));for(var o=0,u=r.length;o<u;o++){var c=r[o],l=s[c];i(l,c,s)&&(a[c]=l)}return a},y.omit=function(t,e,n){if(y.isFunction(e))e=y.negate(e);else{var i=y.map(E(arguments,!1,!1,1),String);e=function(t,e){return!y.contains(i,e)}}return y.pick(t,e,n)},y.defaults=_(y.allKeys,!0),y.create=function(t,e){var n=x(t);return e&&y.extendOwn(n,e),n},y.clone=function(t){return y.isObject(t)?y.isArray(t)?t.slice():y.extend({},t):t},y.tap=function(t,e){return e(t),t},y.isMatch=function(t,e){var n=y.keys(e),i=n.length;if(null==t)return!i;for(var r=Object(t),a=0;a<i;a++){var s=n[a];if(e[s]!==r[s]||!(s in r))return!1}return!0};var O=function(t,e,n,i){if(t===e)return 0!==t||1/t==1/e;if(null==t||null==e)return t===e;t instanceof y&&(t=t._wrapped),e instanceof y&&(e=e._wrapped);var r=h.call(t);if(r!==h.call(e))return!1;switch(r){case"[object RegExp]":case"[object String]":return""+t==""+e;case"[object Number]":return+t!=+t?+e!=+e:0==+t?1/+t==1/e:+t==+e;case"[object Date]":case"[object Boolean]":return+t==+e}var a="[object Array]"===r;if(!a){if("object"!=typeof t||"object"!=typeof e)return!1;var s=t.constructor,o=e.constructor;if(s!==o&&!(y.isFunction(s)&&s instanceof s&&y.isFunction(o)&&o instanceof o)&&"constructor"in t&&"constructor"in e)return!1}i=i||[];for(var u=(n=n||[]).length;u--;)if(n[u]===t)return i[u]===e;if(n.push(t),i.push(e),a){if((u=t.length)!==e.length)return!1;for(;u--;)if(!O(t[u],e[u],n,i))return!1}else{var c,l=y.keys(t);if(u=l.length,y.keys(e).length!==u)return!1;for(;u--;)if(c=l[u],!y.has(e,c)||!O(t[c],e[c],n,i))return!1}return n.pop(),i.pop(),!0};y.isEqual=function(t,e){return O(t,e)},y.isEmpty=function(t){return null==t||(I(t)&&(y.isArray(t)||y.isString(t)||y.isArguments(t))?0===t.length:0===y.keys(t).length)},y.isElement=function(t){return!(!t||1!==t.nodeType)},y.isArray=d||function(t){return"[object Array]"===h.call(t)},y.isObject=function(t){var e=typeof t;return"function"===e||"object"===e&&!!t},y.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(e){y["is"+e]=function(t){return h.call(t)==="[object "+e+"]"}}),y.isArguments(arguments)||(y.isArguments=function(t){return y.has(t,"callee")}),"function"!=typeof/./&&"object"!=typeof Int8Array&&(y.isFunction=function(t){return"function"==typeof t||!1}),y.isFinite=function(t){return isFinite(t)&&!isNaN(parseFloat(t))},y.isNaN=function(t){return y.isNumber(t)&&t!==+t},y.isBoolean=function(t){return!0===t||!1===t||"[object Boolean]"===h.call(t)},y.isNull=function(t){return null===t},y.isUndefined=function(t){return void 0===t},y.has=function(t,e){return null!=t&&f.call(t,e)},y.noConflict=function(){return r._=a,this},y.identity=function(t){return t},y.constant=function(t){return function(){return t}},y.noop=function(){},y.property=T,y.propertyOf=function(e){return null==e?function(){}:function(t){return e[t]}},y.matcher=y.matches=function(e){return e=y.extendOwn({},e),function(t){return y.isMatch(t,e)}},y.times=function(t,e,n){var i=Array(Math.max(0,t));e=w(e,n,1);for(var r=0;r<t;r++)i[r]=e(r);return i},y.random=function(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))},y.now=Date.now||function(){return(new Date).getTime()};var M={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},U=y.invert(M),R=function(e){var n=function(t){return e[t]},t="(?:"+y.keys(e).join("|")+")",i=RegExp(t),r=RegExp(t,"g");return function(t){return t=null==t?"":""+t,i.test(t)?t.replace(r,n):t}};y.escape=R(M),y.unescape=R(U),y.result=function(t,e,n){var i=null==t?void 0:t[e];return void 0===i&&(i=n),y.isFunction(i)?i.call(t):i};var C=0;y.uniqueId=function(t){var e=++C+"";return t?t+e:e},y.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var N=/(.)^/,L={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},F=/\\|'|\r|\n|\u2028|\u2029/g,B=function(t){return"\\"+L[t]};y.template=function(a,t,e){!t&&e&&(t=e),t=y.defaults({},t,y.templateSettings);var n=RegExp([(t.escape||N).source,(t.interpolate||N).source,(t.evaluate||N).source].join("|")+"|$","g"),s=0,o="__p+='";a.replace(n,function(t,e,n,i,r){return o+=a.slice(s,r).replace(F,B),s=r+t.length,e?o+="'+\n((__t=("+e+"))==null?'':_.escape(__t))+\n'":n?o+="'+\n((__t=("+n+"))==null?'':__t)+\n'":i&&(o+="';\n"+i+"\n__p+='"),t}),o+="';\n",t.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{var i=new Function(t.variable||"obj","_",o)}catch(t){throw t.source=o,t}var r=function(t){return i.call(this,t,y)},u=t.variable||"obj";return r.source="function("+u+"){\n"+o+"}",r},y.chain=function(t){var e=y(t);return e._chain=!0,e};var q=function(t,e){return t._chain?y(e).chain():e};y.mixin=function(n){y.each(y.functions(n),function(t){var e=y[t]=n[t];y.prototype[t]=function(){var t=[this._wrapped];return c.apply(t,arguments),q(this,e.apply(y,t))}})},y.mixin(y),y.each(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var n=s[e];y.prototype[e]=function(){var t=this._wrapped;return n.apply(t,arguments),"shift"!==e&&"splice"!==e||0!==t.length||delete t[0],q(this,t)}}),y.each(["concat","join","slice"],function(t){var e=s[t];y.prototype[t]=function(){return q(this,e.apply(this._wrapped,arguments))}}),y.prototype.value=function(){return this._wrapped},y.prototype.valueOf=y.prototype.toJSON=y.prototype.value,y.prototype.toString=function(){return""+this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return y})}).call(this),function(i){var r="object"==typeof self&&self.self==self&&self||"object"==typeof global&&global.global==global&&global;if("function"==typeof define&&define.amd)define(["underscore","jquery","exports"],function(t,e,n){r.Backbone=i(r,n,t,e)});else if("undefined"!=typeof exports){var t,e=require("underscore");try{t=require("jquery")}catch(t){}i(r,exports,e,t)}else r.Backbone=i(r,{},r._,r.jQuery||r.Zepto||r.ender||r.$)}(function(t,u,b,e){var n=t.Backbone,a=Array.prototype.slice;u.VERSION="1.2.3",u.$=e,u.noConflict=function(){return t.Backbone=n,this},u.emulateHTTP=!1,u.emulateJSON=!1;var i=function(n,t,i){b.each(t,function(t,e){b[e]&&(n.prototype[e]=function(t,i,r){switch(t){case 1:return function(){return b[i](this[r])};case 2:return function(t){return b[i](this[r],t)};case 3:return function(t,e){return b[i](this[r],s(t,this),e)};case 4:return function(t,e,n){return b[i](this[r],s(t,this),e,n)};default:return function(){var t=a.call(arguments);return t.unshift(this[r]),b[i].apply(b,t)}}}(t,e,i))})},s=function(e,t){return b.isFunction(e)?e:b.isObject(e)&&!t._isModel(e)?r(e):b.isString(e)?function(t){return t.get(e)}:e},r=function(t){var e=b.matches(t);return function(t){return e(t.attributes)}},o=u.Events={},c=/\s+/,l=function(t,e,n,i,r){var a,s=0;if(n&&"object"==typeof n){void 0!==i&&"context"in r&&void 0===r.context&&(r.context=i);for(a=b.keys(n);s<a.length;s++)e=l(t,e,a[s],n[a[s]],r)}else if(n&&c.test(n))for(a=n.split(c);s<a.length;s++)e=t(e,a[s],i,r);else e=t(e,n,i,r);return e};o.on=function(t,e,n){return h(this,t,e,n)};var h=function(t,e,n,i,r){(t._events=l(f,t._events||{},e,n,{context:i,ctx:t,listening:r}),r)&&((t._listeners||(t._listeners={}))[r.id]=r);return t};o.listenTo=function(t,e,n){if(!t)return this;var i=t._listenId||(t._listenId=b.uniqueId("l")),r=this._listeningTo||(this._listeningTo={}),a=r[i];if(!a){var s=this._listenId||(this._listenId=b.uniqueId("l"));a=r[i]={obj:t,objId:i,id:s,listeningTo:r,count:0}}return h(t,e,n,this,a),this};var f=function(t,e,n,i){if(n){var r=t[e]||(t[e]=[]),a=i.context,s=i.ctx,o=i.listening;o&&o.count++,r.push({callback:n,context:a,ctx:a||s,listening:o})}return t};o.off=function(t,e,n){return this._events&&(this._events=l(d,this._events,t,e,{context:n,listeners:this._listeners})),this},o.stopListening=function(t,e,n){var i=this._listeningTo;if(!i)return this;for(var r=t?[t._listenId]:b.keys(i),a=0;a<r.length;a++){var s=i[r[a]];if(!s)break;s.obj.off(e,n,this)}return b.isEmpty(i)&&(this._listeningTo=void 0),this};var d=function(t,e,n,i){if(t){var r,a=0,s=i.context,o=i.listeners;if(e||n||s){for(var u=e?[e]:b.keys(t);a<u.length;a++){var c=t[e=u[a]];if(!c)break;for(var l=[],h=0;h<c.length;h++){var f=c[h];n&&n!==f.callback&&n!==f.callback._callback||s&&s!==f.context?l.push(f):(r=f.listening)&&0==--r.count&&(delete o[r.id],delete r.listeningTo[r.objId])}l.length?t[e]=l:delete t[e]}return b.size(t)?t:void 0}for(var d=b.keys(o);a<d.length;a++)delete o[(r=o[d[a]]).id],delete r.listeningTo[r.objId]}};o.once=function(t,e,n){var i=l(p,{},t,e,b.bind(this.off,this));return this.on(i,void 0,n)},o.listenToOnce=function(t,e,n){var i=l(p,{},e,n,b.bind(this.stopListening,this,t));return this.listenTo(t,i)};var p=function(t,e,n,i){if(n){var r=t[e]=b.once(function(){i(e,r),n.apply(this,arguments)});r._callback=n}return t};o.trigger=function(t){if(!this._events)return this;for(var e=Math.max(0,arguments.length-1),n=Array(e),i=0;i<e;i++)n[i]=arguments[i+1];return l(v,this._events,t,void 0,n),this};var v=function(t,e,n,i){if(t){var r=t[e],a=t.all;r&&a&&(a=a.slice()),r&&g(r,i),a&&g(a,[e].concat(i))}return t},g=function(t,e){var n,i=-1,r=t.length,a=e[0],s=e[1],o=e[2];switch(e.length){case 0:for(;++i<r;)(n=t[i]).callback.call(n.ctx);return;case 1:for(;++i<r;)(n=t[i]).callback.call(n.ctx,a);return;case 2:for(;++i<r;)(n=t[i]).callback.call(n.ctx,a,s);return;case 3:for(;++i<r;)(n=t[i]).callback.call(n.ctx,a,s,o);return;default:for(;++i<r;)(n=t[i]).callback.apply(n.ctx,e);return}};o.bind=o.on,o.unbind=o.off,b.extend(u,o);var m=u.Model=function(t,e){var n=t||{};e||(e={}),this.cid=b.uniqueId(this.cidPrefix),this.attributes={},e.collection&&(this.collection=e.collection),e.parse&&(n=this.parse(n,e)||{}),n=b.defaults({},n,b.result(this,"defaults")),this.set(n,e),this.changed={},this.initialize.apply(this,arguments)};b.extend(m.prototype,o,{changed:null,validationError:null,idAttribute:"id",cidPrefix:"c",initialize:function(){},toJSON:function(t){return b.clone(this.attributes)},sync:function(){return u.sync.apply(this,arguments)},get:function(t){return this.attributes[t]},escape:function(t){return b.escape(this.get(t))},has:function(t){return null!=this.get(t)},matches:function(t){return!!b.iteratee(t,this)(this.attributes)},set:function(t,e,n){if(null==t)return this;var i;if("object"==typeof t?(i=t,n=e):(i={})[t]=e,n||(n={}),!this._validate(i,n))return!1;var r=n.unset,a=n.silent,s=[],o=this._changing;this._changing=!0,o||(this._previousAttributes=b.clone(this.attributes),this.changed={});var u=this.attributes,c=this.changed,l=this._previousAttributes;for(var h in i)e=i[h],b.isEqual(u[h],e)||s.push(h),b.isEqual(l[h],e)?delete c[h]:c[h]=e,r?delete u[h]:u[h]=e;if(this.id=this.get(this.idAttribute),!a){s.length&&(this._pending=n);for(var f=0;f<s.length;f++)this.trigger("change:"+s[f],this,u[s[f]],n)}if(o)return this;if(!a)for(;this._pending;)n=this._pending,this._pending=!1,this.trigger("change",this,n);return this._pending=!1,this._changing=!1,this},unset:function(t,e){return this.set(t,void 0,b.extend({},e,{unset:!0}))},clear:function(t){var e={};for(var n in this.attributes)e[n]=void 0;return this.set(e,b.extend({},t,{unset:!0}))},hasChanged:function(t){return null==t?!b.isEmpty(this.changed):b.has(this.changed,t)},changedAttributes:function(t){if(!t)return!!this.hasChanged()&&b.clone(this.changed);var e=this._changing?this._previousAttributes:this.attributes,n={};for(var i in t){var r=t[i];b.isEqual(e[i],r)||(n[i]=r)}return!!b.size(n)&&n},previous:function(t){return null!=t&&this._previousAttributes?this._previousAttributes[t]:null},previousAttributes:function(){return b.clone(this._previousAttributes)},fetch:function(n){n=b.extend({parse:!0},n);var i=this,r=n.success;return n.success=function(t){var e=n.parse?i.parse(t,n):t;if(!i.set(e,n))return!1;r&&r.call(n.context,i,t,n),i.trigger("sync",i,t,n)},N(this,n),this.sync("read",this,n)},save:function(t,e,n){var i;null==t||"object"==typeof t?(i=t,n=e):(i={})[t]=e;var r=(n=b.extend({validate:!0,parse:!0},n)).wait;if(i&&!r){if(!this.set(i,n))return!1}else if(!this._validate(i,n))return!1;var a=this,s=n.success,o=this.attributes;n.success=function(t){a.attributes=o;var e=n.parse?a.parse(t,n):t;if(r&&(e=b.extend({},i,e)),e&&!a.set(e,n))return!1;s&&s.call(n.context,a,t,n),a.trigger("sync",a,t,n)},N(this,n),i&&r&&(this.attributes=b.extend({},o,i));var u=this.isNew()?"create":n.patch?"patch":"update";"patch"!==u||n.attrs||(n.attrs=i);var c=this.sync(u,this,n);return this.attributes=o,c},destroy:function(e){e=e?b.clone(e):{};var n=this,i=e.success,r=e.wait,a=function(){n.stopListening(),n.trigger("destroy",n,n.collection,e)},t=!(e.success=function(t){r&&a(),i&&i.call(e.context,n,t,e),n.isNew()||n.trigger("sync",n,t,e)});return this.isNew()?b.defer(e.success):(N(this,e),t=this.sync("delete",this,e)),r||a(),t},url:function(){var t=b.result(this,"urlRoot")||b.result(this.collection,"url")||C();if(this.isNew())return t;var e=this.get(this.idAttribute);return t.replace(/[^\/]$/,"$&/")+encodeURIComponent(e)},parse:function(t,e){return t},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(t){return this._validate({},b.defaults({validate:!0},t))},_validate:function(t,e){if(!e.validate||!this.validate)return!0;t=b.extend({},this.attributes,t);var n=this.validationError=this.validate(t,e)||null;return!n||(this.trigger("invalid",this,n,b.extend(e,{validationError:n})),!1)}});i(m,{keys:1,values:1,pairs:1,invert:1,pick:0,omit:0,chain:1,isEmpty:1},"attributes");var y=u.Collection=function(t,e){e||(e={}),e.model&&(this.model=e.model),void 0!==e.comparator&&(this.comparator=e.comparator),this._reset(),this.initialize.apply(this,arguments),t&&this.reset(t,b.extend({silent:!0},e))},_={add:!0,remove:!0,merge:!0},w={add:!0,remove:!1},x=function(t,e,n){n=Math.min(Math.max(n,0),t.length);for(var i=Array(t.length-n),r=e.length,a=0;a<i.length;a++)i[a]=t[a+n];for(a=0;a<r;a++)t[a+n]=e[a];for(a=0;a<i.length;a++)t[a+r+n]=i[a]};b.extend(y.prototype,o,{model:m,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return u.sync.apply(this,arguments)},add:function(t,e){return this.set(t,b.extend({merge:!1},e,w))},remove:function(t,e){e=b.extend({},e);var n=!b.isArray(t);t=n?[t]:b.clone(t);var i=this._removeModels(t,e);return!e.silent&&i&&this.trigger("update",this,e),n?i[0]:i},set:function(t,e){if(null!=t){(e=b.defaults({},e,_)).parse&&!this._isModel(t)&&(t=this.parse(t,e));var n=!b.isArray(t);t=n?[t]:t.slice();var i=e.at;null!=i&&(i=+i),i<0&&(i+=this.length+1);for(var r,a=[],s=[],o=[],u={},c=e.add,l=e.merge,h=e.remove,f=!1,d=this.comparator&&null==i&&!1!==e.sort,p=b.isString(this.comparator)?this.comparator:null,v=0;v<t.length;v++){r=t[v];var g=this.get(r);if(g){if(l&&r!==g){var m=this._isModel(r)?r.attributes:r;e.parse&&(m=g.parse(m,e)),g.set(m,e),d&&!f&&(f=g.hasChanged(p))}u[g.cid]||(u[g.cid]=!0,a.push(g)),t[v]=g}else c&&(r=t[v]=this._prepareModel(r,e))&&(s.push(r),this._addReference(r,e),u[r.cid]=!0,a.push(r))}if(h){for(v=0;v<this.length;v++)u[(r=this.models[v]).cid]||o.push(r);o.length&&this._removeModels(o,e)}var y=!1,w=!d&&c&&h;if(a.length&&w?(y=this.length!=a.length||b.some(this.models,function(t,e){return t!==a[e]}),this.models.length=0,x(this.models,a,0),this.length=this.models.length):s.length&&(d&&(f=!0),x(this.models,s,null==i?this.length:i),this.length=this.models.length),f&&this.sort({silent:!0}),!e.silent){for(v=0;v<s.length;v++)null!=i&&(e.index=i+v),(r=s[v]).trigger("add",r,this,e);(f||y)&&this.trigger("sort",this,e),(s.length||o.length)&&this.trigger("update",this,e)}return n?t[0]:t}},reset:function(t,e){e=e?b.clone(e):{};for(var n=0;n<this.models.length;n++)this._removeReference(this.models[n],e);return e.previousModels=this.models,this._reset(),t=this.add(t,b.extend({silent:!0},e)),e.silent||this.trigger("reset",this,e),t},push:function(t,e){return this.add(t,b.extend({at:this.length},e))},pop:function(t){var e=this.at(this.length-1);return this.remove(e,t)},unshift:function(t,e){return this.add(t,b.extend({at:0},e))},shift:function(t){var e=this.at(0);return this.remove(e,t)},slice:function(){return a.apply(this.models,arguments)},get:function(t){if(null!=t){var e=this.modelId(this._isModel(t)?t.attributes:t);return this._byId[t]||this._byId[e]||this._byId[t.cid]}},at:function(t){return t<0&&(t+=this.length),this.models[t]},where:function(t,e){return this[e?"find":"filter"](t)},findWhere:function(t){return this.where(t,!0)},sort:function(t){var e=this.comparator;if(!e)throw new Error("Cannot sort a set without a comparator");t||(t={});var n=e.length;return b.isFunction(e)&&(e=b.bind(e,this)),1===n||b.isString(e)?this.models=this.sortBy(e):this.models.sort(e),t.silent||this.trigger("sort",this,t),this},pluck:function(t){return b.invoke(this.models,"get",t)},fetch:function(n){var i=(n=b.extend({parse:!0},n)).success,r=this;return n.success=function(t){var e=n.reset?"reset":"set";r[e](t,n),i&&i.call(n.context,r,t,n),r.trigger("sync",r,t,n)},N(this,n),this.sync("read",this,n)},create:function(t,e){var i=(e=e?b.clone(e):{}).wait;if(!(t=this._prepareModel(t,e)))return!1;i||this.add(t,e);var r=this,a=e.success;return e.success=function(t,e,n){i&&r.add(t,n),a&&a.call(n.context,t,e,n)},t.save(null,e),t},parse:function(t,e){return t},clone:function(){return new this.constructor(this.models,{model:this.model,comparator:this.comparator})},modelId:function(t){return t[this.model.prototype.idAttribute||"id"]},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(t,e){if(this._isModel(t))return t.collection||(t.collection=this),t;var n=new(((e=e?b.clone(e):{}).collection=this).model)(t,e);return n.validationError?(this.trigger("invalid",this,n.validationError,e),!1):n},_removeModels:function(t,e){for(var n=[],i=0;i<t.length;i++){var r=this.get(t[i]);if(r){var a=this.indexOf(r);this.models.splice(a,1),this.length--,e.silent||(e.index=a,r.trigger("remove",r,this,e)),n.push(r),this._removeReference(r,e)}}return!!n.length&&n},_isModel:function(t){return t instanceof m},_addReference:function(t,e){this._byId[t.cid]=t;var n=this.modelId(t.attributes);null!=n&&(this._byId[n]=t),t.on("all",this._onModelEvent,this)},_removeReference:function(t,e){delete this._byId[t.cid];var n=this.modelId(t.attributes);null!=n&&delete this._byId[n],this===t.collection&&delete t.collection,t.off("all",this._onModelEvent,this)},_onModelEvent:function(t,e,n,i){if("add"!==t&&"remove"!==t||n===this){if("destroy"===t&&this.remove(e,i),"change"===t){var r=this.modelId(e.previousAttributes()),a=this.modelId(e.attributes);r!==a&&(null!=r&&delete this._byId[r],null!=a&&(this._byId[a]=e))}this.trigger.apply(this,arguments)}}});i(y,{forEach:3,each:3,map:3,collect:3,reduce:4,foldl:4,inject:4,reduceRight:4,foldr:4,find:3,detect:3,filter:3,select:3,reject:3,every:3,all:3,some:3,any:3,include:3,includes:3,contains:3,invoke:0,max:3,min:3,toArray:1,size:1,first:3,head:3,take:3,initial:3,rest:3,tail:3,drop:3,last:3,without:0,difference:0,indexOf:3,shuffle:1,lastIndexOf:3,isEmpty:1,chain:1,sample:3,partition:3,groupBy:3,countBy:3,sortBy:3,indexBy:3},"models");var T=u.View=function(t){this.cid=b.uniqueId("view"),b.extend(this,b.pick(t,S)),this._ensureElement(),this.initialize.apply(this,arguments)},k=/^(\S+)\s*(.*)$/,S=["model","collection","el","id","attributes","className","tagName","events"];b.extend(T.prototype,o,{tagName:"div",$:function(t){return this.$el.find(t)},initialize:function(){},render:function(){return this},remove:function(){return this._removeElement(),this.stopListening(),this},_removeElement:function(){this.$el.remove()},setElement:function(t){return this.undelegateEvents(),this._setElement(t),this.delegateEvents(),this},_setElement:function(t){this.$el=t instanceof u.$?t:u.$(t),this.el=this.$el[0]},delegateEvents:function(t){if(t||(t=b.result(this,"events")),!t)return this;for(var e in this.undelegateEvents(),t){var n=t[e];if(b.isFunction(n)||(n=this[n]),n){var i=e.match(k);this.delegate(i[1],i[2],b.bind(n,this))}}return this},delegate:function(t,e,n){return this.$el.on(t+".delegateEvents"+this.cid,e,n),this},undelegateEvents:function(){return this.$el&&this.$el.off(".delegateEvents"+this.cid),this},undelegate:function(t,e,n){return this.$el.off(t+".delegateEvents"+this.cid,e,n),this},_createElement:function(t){return document.createElement(t)},_ensureElement:function(){if(this.el)this.setElement(b.result(this,"el"));else{var t=b.extend({},b.result(this,"attributes"));this.id&&(t.id=b.result(this,"id")),this.className&&(t.class=b.result(this,"className")),this.setElement(this._createElement(b.result(this,"tagName"))),this._setAttributes(t)}},_setAttributes:function(t){this.$el.attr(t)}}),u.sync=function(t,e,i){var n=I[t];b.defaults(i||(i={}),{emulateHTTP:u.emulateHTTP,emulateJSON:u.emulateJSON});var r={type:n,dataType:"json"};if(i.url||(r.url=b.result(e,"url")||C()),null!=i.data||!e||"create"!==t&&"update"!==t&&"patch"!==t||(r.contentType="application/json",r.data=JSON.stringify(i.attrs||e.toJSON(i))),i.emulateJSON&&(r.contentType="application/x-www-form-urlencoded",r.data=r.data?{model:r.data}:{}),i.emulateHTTP&&("PUT"===n||"DELETE"===n||"PATCH"===n)){r.type="POST",i.emulateJSON&&(r.data._method=n);var a=i.beforeSend;i.beforeSend=function(t){if(t.setRequestHeader("X-HTTP-Method-Override",n),a)return a.apply(this,arguments)}}"GET"===r.type||i.emulateJSON||(r.processData=!1);var s=i.error;i.error=function(t,e,n){i.textStatus=e,i.errorThrown=n,s&&s.call(i.context,t,e,n)};var o=i.xhr=u.ajax(b.extend(r,i));return e.trigger("request",e,o,i),o};var I={create:"POST",update:"PUT",patch:"PATCH",delete:"DELETE",read:"GET"};u.ajax=function(){return u.$.ajax.apply(u.$,arguments)};var $=u.Router=function(t){t||(t={}),t.routes&&(this.routes=t.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},E=/\((.*?)\)/g,A=/(\(\?)?:\w+/g,j=/\*\w+/g,P=/[\-{}\[\]+?.,\\\^$|#\s]/g;b.extend($.prototype,o,{initialize:function(){},route:function(n,i,r){b.isRegExp(n)||(n=this._routeToRegExp(n)),b.isFunction(i)&&(r=i,i=""),r||(r=this[i]);var a=this;return u.history.route(n,function(t){var e=a._extractParameters(n,t);!1!==a.execute(r,e,i)&&(a.trigger.apply(a,["route:"+i].concat(e)),a.trigger("route",i,e),u.history.trigger("route",a,i,e))}),this},execute:function(t,e,n){t&&t.apply(this,e)},navigate:function(t,e){return u.history.navigate(t,e),this},_bindRoutes:function(){if(this.routes){this.routes=b.result(this,"routes");for(var t,e=b.keys(this.routes);null!=(t=e.pop());)this.route(t,this.routes[t])}},_routeToRegExp:function(t){return t=t.replace(P,"\\$&").replace(E,"(?:$1)?").replace(A,function(t,e){return e?t:"([^/?]+)"}).replace(j,"([^?]*?)"),new RegExp("^"+t+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(t,e){var n=t.exec(e).slice(1);return b.map(n,function(t,e){return e===n.length-1?t||null:t?decodeURIComponent(t):null})}});var O=u.History=function(){this.handlers=[],this.checkUrl=b.bind(this.checkUrl,this),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},M=/^[#\/]|\s+$/g,U=/^\/+|\/+$/g,R=/#.*$/;O.started=!1,b.extend(O.prototype,o,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root&&!this.getSearch()},matchRoot:function(){return this.decodeFragment(this.location.pathname).slice(0,this.root.length-1)+"/"===this.root},decodeFragment:function(t){return decodeURI(t.replace(/%25/g,"%2525"))},getSearch:function(){var t=this.location.href.replace(/#.*/,"").match(/\?.+/);return t?t[0]:""},getHash:function(t){var e=(t||this).location.href.match(/#(.*)$/);return e?e[1]:""},getPath:function(){var t=this.decodeFragment(this.location.pathname+this.getSearch()).slice(this.root.length-1);return"/"===t.charAt(0)?t.slice(1):t},getFragment:function(t){return null==t&&(t=this._usePushState||!this._wantsHashChange?this.getPath():this.getHash()),t.replace(M,"")},start:function(t){if(O.started)throw new Error("Backbone.history has already been started");if(O.started=!0,this.options=b.extend({root:"/"},this.options,t),this.root=this.options.root,this._wantsHashChange=!1!==this.options.hashChange,this._hasHashChange="onhashchange"in window&&(void 0===document.documentMode||7<document.documentMode),this._useHashChange=this._wantsHashChange&&this._hasHashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!(!this.history||!this.history.pushState),this._usePushState=this._wantsPushState&&this._hasPushState,this.fragment=this.getFragment(),this.root=("/"+this.root+"/").replace(U,"/"),this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot()){var e=this.root.slice(0,-1)||"/";return this.location.replace(e+"#"+this.getPath()),!0}this._hasPushState&&this.atRoot()&&this.navigate(this.getHash(),{replace:!0})}if(!this._hasHashChange&&this._wantsHashChange&&!this._usePushState){this.iframe=document.createElement("iframe"),this.iframe.src="javascript:0",this.iframe.style.display="none",this.iframe.tabIndex=-1;var n=document.body,i=n.insertBefore(this.iframe,n.firstChild).contentWindow;i.document.open(),i.document.close(),i.location.hash="#"+this.fragment}var r=window.addEventListener||function(t,e){return attachEvent("on"+t,e)};if(this._usePushState?r("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe?r("hashchange",this.checkUrl,!1):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),!this.options.silent)return this.loadUrl()},stop:function(){var t=window.removeEventListener||function(t,e){return detachEvent("on"+t,e)};this._usePushState?t("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe&&t("hashchange",this.checkUrl,!1),this.iframe&&(document.body.removeChild(this.iframe),this.iframe=null),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),O.started=!1},route:function(t,e){this.handlers.unshift({route:t,callback:e})},checkUrl:function(t){var e=this.getFragment();if(e===this.fragment&&this.iframe&&(e=this.getHash(this.iframe.contentWindow)),e===this.fragment)return!1;this.iframe&&this.navigate(e),this.loadUrl()},loadUrl:function(e){return!!this.matchRoot()&&(e=this.fragment=this.getFragment(e),b.some(this.handlers,function(t){if(t.route.test(e))return t.callback(e),!0}))},navigate:function(t,e){if(!O.started)return!1;e&&!0!==e||(e={trigger:!!e}),t=this.getFragment(t||"");var n=this.root;""!==t&&"?"!==t.charAt(0)||(n=n.slice(0,-1)||"/");var i=n+t;if(t=this.decodeFragment(t.replace(R,"")),this.fragment!==t){if(this.fragment=t,this._usePushState)this.history[e.replace?"replaceState":"pushState"]({},document.title,i);else{if(!this._wantsHashChange)return this.location.assign(i);if(this._updateHash(this.location,t,e.replace),this.iframe&&t!==this.getHash(this.iframe.contentWindow)){var r=this.iframe.contentWindow;e.replace||(r.document.open(),r.document.close()),this._updateHash(r.location,t,e.replace)}}return e.trigger?this.loadUrl(t):void 0}},_updateHash:function(t,e,n){if(n){var i=t.href.replace(/(javascript:|#).*$/,"");t.replace(i+"#"+e)}else t.hash="#"+e}}),u.history=new O;m.extend=y.extend=$.extend=T.extend=O.extend=function(t,e){var n,i=this;n=t&&b.has(t,"constructor")?t.constructor:function(){return i.apply(this,arguments)},b.extend(n,i,e);var r=function(){this.constructor=n};return r.prototype=i.prototype,n.prototype=new r,t&&b.extend(n.prototype,t),n.__super__=i.prototype,n};var C=function(){throw new Error('A "url" property or function must be specified')},N=function(e,n){var i=n.error;n.error=function(t){i&&i.call(n.context,e,t,n),e.trigger("error",e,t,n)}};return u}),function(t){"function"==typeof define&&define.amd?define(["backbone","underscore"],t):"object"==typeof exports?module.exports=t(require("backbone"),require("underscore")):t(window.Backbone,window._)}(function(t,r){var a=t.Router.prototype.route,s=function(){};r.extend(t.Router.prototype,{before:s,after:s,route:function(e,t,n){n||(n=this[t]);var i=r.bind(function(){var t=[e,r.toArray(arguments)];!1!==(r.isFunction(this.before)?this.before:void 0!==this.before[e]?this.before[e]:s).apply(this,t)&&(n&&n.apply(this,arguments),(r.isFunction(this.after)?this.after:void 0!==this.after[e]?this.after[e]:s).apply(this,t))},this);return a.call(this,e,t,i)}})}),function(Tq){if("function"==typeof require&&"object"==typeof exports&&"object"==typeof module){try{var Uq=require("jquery")}catch(t){}module.exports=Tq(Uq)}else if("function"==typeof define&&define.amd)define(["jquery"],function(t){return Tq(t)});else{var Vq;try{Vq=eval("this")}catch(t){Vq=window}Vq.deparam=Tq(Vq.jQuery)}}(function(t){var e=function(t,u){var c={},l={true:!0,false:!1,null:null};return t.replace(/\+/g," ").split("&").forEach(function(t){var e,n=t.split("="),i=decodeURIComponent(n[0]),r=c,a=0,s=i.split("]["),o=s.length-1;if(/\[/.test(s[0])&&/\]$/.test(s[o])?(s[o]=s[o].replace(/\]$/,""),o=(s=s.shift().split("[").concat(s)).length-1):o=0,2===n.length)if(e=decodeURIComponent(n[1]),u&&(e=e&&!isNaN(e)&&+e+""===e?+e:"undefined"===e?void 0:void 0!==l[e]?l[e]:e),o)for(;a<=o;a++)r=r[i=""===s[a]?r.length:s[a]]=a<o?r[i]||(s[a+1]&&isNaN(s[a+1])?{}:[]):e;else"[object Array]"===Object.prototype.toString.call(c[i])?c[i].push(e):!{}.hasOwnProperty.call(c,i)?c[i]=e:c[i]=[c[i],e];else i&&(c[i]=u?void 0:"")}),c};return t&&(t.prototype.deparam=t.deparam=e),e}),function(t,e){"object"==typeof exports&&module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.PubSub=e()}("object"==typeof window&&window||this,function(){var n={},u={},i=-1;function c(t){var e;for(e in t)if(t.hasOwnProperty(e))return!0;return!1}function o(t,e,n){try{t(e,n)}catch(t){setTimeout((i=t,function(){throw i}),0)}var i}function l(t,e,n){t(e,n)}function h(t,e,n,i){var r,a=u[e],s=i?l:o;if(u.hasOwnProperty(e))for(r in a)a.hasOwnProperty(r)&&s(a[r],t,n)}function r(t,e,n,i){var r,a,s,o=(r=t,a=e,s=i,function(){var t=String(r),e=t.lastIndexOf(".");for(h(r,r,a,s);-1!==e;)e=(t=t.substr(0,e)).lastIndexOf("."),h(r,t,a)});return!!function(t){for(var e=String(t),n=Boolean(u.hasOwnProperty(e)&&c(u[e])),i=e.lastIndexOf(".");!n&&-1!==i;)i=(e=e.substr(0,i)).lastIndexOf("."),n=Boolean(u.hasOwnProperty(e)&&c(u[e]));return n}(t)&&(!0===n?o():setTimeout(o,0),!0)}return n.publish=function(t,e){return r(t,e,!1,n.immediateExceptions)},n.publishSync=function(t,e){return r(t,e,!0,n.immediateExceptions)},n.subscribe=function(t,e){if("function"!=typeof e)return!1;u.hasOwnProperty(t)||(u[t]={});var n="uid_"+String(++i);return u[t][n]=e,n},n.unsubscribe=function(t){var e,n,i,r="string"==typeof t,a=!1;for(e in u)if(u.hasOwnProperty(e)){if(n=u[e],r&&n[t]){delete n[t],a=t;break}if(!r)for(i in n)n.hasOwnProperty(i)&&n[i]===t&&(delete n[i],a=!0)}return a},n}),Object.defineProperty(HTMLMediaElement.prototype,"playing",{get:function(){return!!(0<this.currentTime&&!this.paused&&!this.ended&&2<this.readyState)}}),jQuery.fn.getInputSelection=function(){var t=this.get(0),e={start:0,end:0,text:""};if(t){if("selectionStart"in t)e.start=t.selectionStart,e.end=t.selectionEnd,e.text=t.value.substring(e.start,e.end);else if(document.selection){t.focus();var n=document.selection.createRange(),i=document.selection.createRange().text.length;n.moveStart("character",-t.value.length),e.start=n.text.length-i,e.end=e.start+i,e.text=n.text}return e}},jQuery.fn.setInputPosition=function(t){var e=this.get(0);if(e)if(e.focus(),"selectionStart"in e)e.setSelectionRange(t,t);else if(e.createTextRange){var n=e.createTextRange();n.move("character",t),n.select()}},function(r){r.fn.getTextSize=function(){var t="text-width-tester",e=this.val(),n=r("#"+t),i={fontWeight:this.css("font-weight"),fontSize:this.css("font-size"),fontFamily:this.css("font-family"),display:"none"};return n.length?n.css(i).html(e):((n=r('<span id="'+t+'">'+e+"</span>")).css(i),r("body").append(n)),{width:n.width(),height:n.height()}}}(jQuery),window.UTIL={},UTIL.escapeInput=function(t){return t.replace(/"/g,"&quot;")},UTIL.formatDate=function(t){var e=new Date(t);return e.getFullYear()+"-"+e.getMonth()+"-"+e.getDate()},UTIL.formatNumber=function(t){return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},UTIL.formatNumberTiny=function(t,e){e||0===e||(e=1);var n=t;return 1e6<t?n=UTIL.round(t/1e6,e)+"M+":1e6==t?n="1M":99999<t?n=UTIL.round(t/1e3)+"K+":1e3<t?n=UTIL.round(t/1e3,e)+"K+":1e3==t&&(n="1K"),n},UTIL.formatTime=function(t,e){var n,i=t||0,r=parseInt(Math.floor(i/3600))%24,a=parseInt(Math.floor(i/60))%60;return"0"==(n=(0<r?r+":":"")+(a<10?"0"+a:a)+":"+((i=UTIL.round(i%60,e))<10?"0"+i:i))[0]&&(n=n.substring(1,n.length)),n},UTIL.formatTimeAlt=function(t){var e=t||0,n=parseInt(Math.floor(e/3600))%24,i=parseInt(Math.floor(e/60))%60;return e=UTIL.round(e%60),0<i?(0<n?n+"h ":"")+i+"m":e+"s"},UTIL.formatTimeMs=function(t,e){return UTIL.formatTime(.001*t,e)},UTIL.getSeconds=function(t,e){for(var n=t.split(":").reverse(),i=0,r=n.length-1;0<=r;r--)switch(r){case 2:i+=60*parseInt(n[r])*60;break;case 1:i+=60*parseInt(n[r]);break;case 0:i+=parseFloat(n[r])}return UTIL.round(i,e)},UTIL.highlightText=function(t,e,n,i){n=n||"<span>",i=i||"</span>";var r=new RegExp("("+t+")","ig");return e.replace(r,n+"$1"+i)},UTIL.makeId=function(t){for(var e="",n="abcdefghijklmnopqrstuvwxyz",i="abcdefghijklmnopqrstuvwxyz0123456789",r=(t=t||8,0);r<t;r++)e+=r<=0?n.charAt(Math.floor(Math.random()*n.length)):i.charAt(Math.floor(Math.random()*i.length));return e},UTIL.randomNumber=function(t){return Math.floor(Math.pow(10,t-1)+9*Math.random()*Math.pow(10,t-1))},UTIL.round=function(t,e){return t=parseFloat(t),e=e||0,Math.round(t*Math.pow(10,e))/Math.pow(10,e)};var COMPONENTS=function(){function t(){this.init()}return t.prototype.init=function(){this.selectInit(),this.alertInit(),this.scrollInit(),this.stickyInit(),this.toggleInit(),this.toggleSoundInit()},t.prototype.alert=function(t,e,n,i){n=n||"#primary-alert",i=i||3e3;var r=$(n);r.html("<div>"+t+"</div>").addClass("active"),this.timeout&&clearTimeout(this.timeout),e&&(this.timeout=setTimeout(function(){r.removeClass("active")},i))},t.prototype.alertInit=function(){var a=this;$(window).on("alert",function(t,e,n,i,r){a.alert(e,n,i,r)}),$(".alert").on("click",function(){$(this).removeClass("active")})},t.prototype.scrollInit=function(){var r=this;$(window).on("scroll-to",function(t,e,n,i){r.scrollTo(e,n,i)})},t.prototype.scrollTo=function(t,e,n){e=e||0,n=n||2e3,$("html, body").animate({scrollTop:t.offset().top-e},2e3)},t.prototype.select=function(t){var e=t.closest(".select"),n=e.find(".select-active"),i=e.find(".select-option"),r=t.attr("data-active")||t.text();i.removeClass("selected").attr("aria-checked","false"),t.addClass("selected").attr("aria-checked","true"),n.text(r),e.removeClass("active")},t.prototype.selectInit=function(){var e=this;$(document).on("click",".select-active",function(){e.selectMenu($(this).closest(".select"))}),$(document).on("click",".select-option",function(){e.select($(this))}),$(document).on("click",function(t){$(t.target).closest(".select").length||e.selectMenusHide()})},t.prototype.selectMenu=function(t){t.addClass("active")},t.prototype.selectMenusHide=function(){$(".select").removeClass("active")},t.prototype.sticky=function(t){var e=$(".sticky-on-scroll");if(!e.length)return!1;var n=t?$(t).height():0,i=$(window).scrollTop();e.each(function(){var t=$(this);t.offset().top-n<i?$(t.attr("data-sticky")).addClass("sticky"):$(t.attr("data-sticky")).removeClass("sticky")})},t.prototype.stickyInit=function(){var n=this;$(window).on("sticky-on",function(t,e){n.stickyOn(e)})},t.prototype.stickyOn=function(t){if(this.sticky_is_on)return!1;this.sticky_is_on=!0;var e=this;$(window).on("scroll",function(){e.sticky(t)})},t.prototype.toggle=function(t){$(t).toggleClass("active")},t.prototype.toggleInit=function(){var e=this;$(document).on("click",".toggle-active",function(t){t.preventDefault(),e.toggle($(this).attr("data-target"))})},t.prototype.toggleSound=function(t){var e=t[0];e&&e.muted?e.muted=!1:e&&(e.muted=!0)},t.prototype.toggleSoundInit=function(){var e=this;$(document).on("click",".toggle-sound",function(t){t.preventDefault(),e.toggleSound($(this))})},t}();$(function(){new COMPONENTS}),window.API_URL=PROJECT.apiUrl||window.location.protocol+"//"+window.location.hostname,window.location.port&&!PROJECT.apiUrl&&(window.API_URL+=":"+window.location.port),window.DEBUG=!0,window.app={models:{},collections:{},views:{},routers:{},initialize:function(){_.object(_.map(PROJECT.authProviders,function(t){return[t.name,t.path]}));PubSub.subscribe("auth.oAuthSignIn.success",function(t,e){window.location.reload(!0)}),PubSub.subscribe("auth.signOut.success",function(t,e){window.location.reload(!0)});new app.routers.DefaultRouter;var t=!(!window.history||!window.history.pushState);Backbone.history=Backbone.history||new Backbone.History({}),Backbone.history.start({pushState:t})}},window.app.pageTitle=function(t){t||(t="");var e=document.getElementsByTagName("title");if(!e.length)return"";var n=e[0],i=n.getAttribute("data-title-sitename")?n.getAttribute("data-title-sitename"):n.textContent,r=n.getAttribute("data-title-template")?n.getAttribute("data-title-template"):"";return t.length&&r.length?r.replace("{{sitename}}",i).replace("{{pagename}}",t):n.textContent},$(function(){app.initialize()}),app.routers.DefaultRouter=Backbone.Router.extend({routes:{admin:"stats",moderator:"flags"},before:function(t,e){},after:function(t,e){},flags:function(){var t=this._getData(t),e=(new app.views.Header(t),new app.views.AdminFlags(t));new app.views.Footer(t);$("#main").append(e.$el)},stats:function(){var t=this._getData(t),e=(new app.views.Header(t),new app.views.AdminStats(t)),n=new app.views.AdminUsers(t),i=new app.views.AdminFlags(t),r=(new app.views.Footer(t),$('<div class="row"></div>')),a=$('<div class="col"></div>'),s=$('<div class="col"></div>'),o=$('<div class="row"></div>');a.append(e.$el),s.append(n.$el),r.append(a).append(s),o.append(i.$el),$("#main").append(r).append(o)},_getData:function(t){var e={};return $.auth.user&&$.auth.user.signedIn&&(e=$.auth.user),t=t||{},t=$.extend({},{project:PROJECT,user:e,debug:DEBUG,route:this._getRouteData()},t),DEBUG&&console.log("Route",t.route),t},_getRouteData:function(){var t,e=this,n=Backbone.history.fragment,i=_.pairs(e.routes),r=null,a=null,s=null;return(t=_.find(i,function(t){return(a=_.isRegExp(t[0])?t[0]:e._routeToRegExp(t[0])).test(n)}))&&(s=e._extractParameters(a,n),r=t[0],a=t[1]),{route:r,action:a,fragment:n,path:n?"/#/"+n:"/",params:s}}}),app.views.Base=Backbone.View.extend({}),app.views.Header=app.views.Base.extend({el:"#header",title_template:_.template(TEMPLATES["header_title.ejs"]),initialize:function(t){this.data=t,this.render()},render:function(){this.renderTitle();new app.views.Crumbs(_.extend({},this.data,{el:"#header-crumbs"})),new app.views.Menu(_.extend({},this.data,{el:"#primary-menu-container",menu_key:"header"})),new app.views.Account(this.data);return this},renderTitle:function(){this.$el.find("#header-title").html(this.title_template(this.data))}}),app.views.Footer=app.views.Base.extend({el:"#footer",initialize:function(t){this.data=_.extend({},t),this.render()},render:function(){return this.renderContent(),this.renderMenu(),this},renderContent:function(){if(this.data.project.pages["footer.md"]){var t=new app.views.Page(_.extend({},this.data,{page_key:"footer.md"}));this.$el.append(t.render().$el)}},renderMenu:function(){new app.views.Menu(_.extend({},this.data,{el:"#footer-menu-container",menu_key:"footer"}))}}),app.views.Account=app.views.Base.extend({el:"#account-container",template:_.template(TEMPLATES["account.ejs"]),events:{"click .auth-link":"doAuthFromLink","click .check-auth-link":"checkAuthForLink","click .sign-out-link":"signOut"},initialize:function(t){this.data=t,this.data.signedIn=!1,this.data.score=0,this.loadListeners(),this.loadUser(),this.render()},loadUser:function(){var e=this;console.log("Logged in user"),$.post(API_URL+"/authenticate.json",function(t){user=t.user,user.id?(e.data.signedIn=!0,e.data.user=user,e.data.score=user.lines_edited,PubSub.publish("auth.validation.success",user)):(e.data.signedIn=!1,e.data.user=null,e.data.score=null)})},doAuth:function(t){$.auth.oAuthSignIn({provider:t}).fail(function(t){$(window).trigger("alert",["Authentication failure: "+t.errors.join(" ")])})},doAuthFromLink:function(t){t.preventDefault();var e=$(t.currentTarget).attr("data-provider");this.doAuth(e)},checkAuthForLink:function(e){e.preventDefault(),$.auth.validateToken().then(function(t){console.log("checkAuthForLink success"),window.location.href=e.target.href}).fail(function(){console.log("checkAuthForLink failure"),$(window).trigger("alert",["You must log in as admin to access this section.",!0])})},listenForAuth:function(){var n=this;PubSub.subscribe("auth.oAuthSignIn.success",function(t,e){n.onValidationSuccess($.auth.user),$(window).trigger("alert",["Successfully signed in as "+$.auth.user.name+"!  Refreshing page...",!0])}),PubSub.subscribe("auth.validation.success",function(t,e){n.onValidationSuccess(e)}),PubSub.subscribe("auth.signOut.success",function(t,e){n.onSignOutSuccess(),$(window).trigger("alert",["Successfully signed out! Refreshing page...",!0])})},loadListeners:function(){var n=this;this.listenForAuth(),PubSub.subscribe("transcript.edit.submit",function(t,e){e.is_new&&n.data.user.signedIn&&(n.data.score+=1,n.updateScore())})},onSignOutSuccess:function(){this.data.user={},this.data.score=0,window.history.pushState({},document.title,"/")},onValidationSuccess:function(t){this.data.user=t,this.data.score=t.lines_edited,this.render()},render:function(){return this.$el.html(this.template(this.data)),this},signOut:function(t){t&&t.preventDefault(),$.auth.signOut()},updateScore:function(){this.$(".score").text(UTIL.formatNumberTiny(this.data.score)).addClass("active")}}),app.views.Crumbs=app.views.Base.extend({template:_.template(TEMPLATES["crumbs.ejs"]),initialize:function(t){this.data=t,this.data.crumbs=this.data.crumbs||[],this.listenForCrumbs(),this.render()},listenForCrumbs:function(){var i=this;PubSub.subscribe("transcript.load",function(t,e){var n={label:e.label||e.transcript.title};i.data.crumbs=[n],i.render()})},render:function(){return this.$el.html(this.template(this.data)),this}}),app.views.Menu=app.views.Base.extend({template:_.template(TEMPLATES["menu.ejs"]),initialize:function(t){this.data=t,this.data.menu_key=this.data.menu_key||"";var e=this.data.project.menus||{},n=this.data.menu_key;this.data.menu=[],n&&e[n]&&(this.data.menu=e[n]),this.render()},render:function(){return this.$el.html(this.toString()),this},toString:function(){return this.template(this.data)}}),app.views.Modal=app.views.Base.extend({tagName:"div",className:"modal-wrapper",template:_.template(TEMPLATES["modal.ejs"]),events:{"click .modal-tab":"tab"},initialize:function(t){this.data=_.extend({},t),this.data.active_page=0,this.data.active=!1,this.loadContents(),this.render()},loadContents:function(){var i=this,r=this.data.page?[this.data.page]:this.data.pages;_.each(r,function(t,e){var n=new app.views.Page(_.extend({},i.data,{page_key:t.file}));r[e].contents=n.toString()}),this.data.pages=r},render:function(){return this.$el.html(this.template(this.data)),this},tab:function(t){t&&t.preventDefault();var e=$(t.currentTarget);this.data.active_page=parseInt(e.attr("data-tab")),this.data.active=!0,this.render()}}),app.views.Page=app.views.Base.extend({template:_.template(TEMPLATES["page.ejs"]),initialize:function(t){this.data=_.extend({},t),this.data.content=this.data.content||"",this.getPageContent(),this.el&&this.render(),this.displayQueryStringAlert()},getPageContent:function(){var t=this.data.page_key,e=this.data.project.pages;if(!t)return!1;if(e[t]||(t+=".md"),e[t]){var n=_.template(e[t]);this.data.content=n(this.data)}},getPageTitle:function(){if(this.data.page_key){var t=this.data.content.match(/<h1.*>([^<]+)<\/h1>/);if(t)return t[1]}return""},render:function(){this.$el.html(this.toString());var t=this.getPageTitle();return t.length&&(document.title=app.pageTitle(t)),this},toString:function(){return this.template(this.data)},displayQueryStringAlert:function(){if(window.location.search&&window.location.search.length){var t=window.location.search.match(/show_alert=([^&]+)/);if(t){$(window).trigger("alert",[decodeURIComponent(t[1]).replace(/\+/g," "),!0]);var e=window.location.href.replace("show_alert="+t[1]).replace(/(&+)/,"&").replace(/(\?&)/,"?");window.history.pushState({},document.title,e)}}}}),app.views.AdminFlags=app.views.Base.extend({template:_.template(TEMPLATES["admin_flags.ejs"]),className:"flags",initialize:function(t){this.data=_.extend({},t),this.render(),this.loadData()},loadData:function(){var e=this;$.getJSON("/admin/flags.json",function(t){e.renderFlags(t.flags)})},render:function(){return this.$el.html(this.template(this.data)),this},renderFlags:function(t){var n=this.$("#flags-container");n.empty(),_.each(t,function(t){var e=new app.views.FlagItem({flag:t});n.append(e.$el)})}}),app.views.FlagItem=app.views.Base.extend({template:_.template(TEMPLATES["admin_flag_item.ejs"]),tagName:"tr",className:"flag-item",initialize:function(t){this.data=_.extend({},t),this.flag=this.data.flag,this.render()},render:function(){return this.$el.html(this.template(this.flag)),this}}),app.views.AdminStats=app.views.Base.extend({className:"stats",template:_.template(TEMPLATES["admin_stats.ejs"]),initialize:function(t){this.data=_.extend({},t),this.loadData()},loadData:function(){var e=this;$.getJSON("/admin.json",function(t){e.parseData(t.stats)})},parseData:function(o){_.each(o,function(t,e){var n=_.map(t.data,function(t){return t.date=Date.parse(t.date),t}),i=[];i.push({label:"All Time",value:_.reduce(n,function(t,e){return t+e.count},0)});var r=(new Date).getTime()-2592e6;n=_.filter(n,function(t){return t.date>r}),i.push({label:"Past 30 days",value:_.reduce(n,function(t,e){return t+e.count},0)});var a=(new Date).getTime()-6048e5;n=_.filter(n,function(t){return t.date>a}),i.push({label:"Past 7 days",value:_.reduce(n,function(t,e){return t+e.count},0)});var s=(new Date).getTime()-864e5;n=_.filter(n,function(t){return t.date>s}),i.push({label:"Past 24 hours",value:_.reduce(n,function(t,e){return t+e.count},0)}),o[e].sums=i}),this.data.stats=o,this.render()},render:function(){return this.$el.html(this.template(this.data)),this}}),app.views.AdminTranscripts=app.views.Base.extend({el:"#main",initialize:function(t){this.data=_.extend({},t),this.render()},render:function(){return this.$el.html("<p>Hello Admin - Transcripts</p>"),this}}),app.views.AdminUsers=app.views.Base.extend({template:_.template(TEMPLATES["admin_users.ejs"]),className:"users",initialize:function(t){this.data=_.extend({},t),this.render(),this.loadData()},loadData:function(){var e=this;$.getJSON("/admin/users.json",function(t){e.renderUsers(t)})},render:function(){return this.$el.html(this.template(this.data)),this},renderUsers:function(t){var n=this.$("#users-container"),e=t.users,i=t.roles;n.empty(),_.each(e,function(t){var e=new app.views.UserItem({user:t,roles:i});n.append(e.$el)})}}),app.views.UserItem=app.views.Base.extend({template:_.template(TEMPLATES["admin_user_item.ejs"]),tagName:"tr",className:"user-item",initialize:function(t){this.data=_.extend({},t),this.render(),this.loadListeners()},changeRole:function(e){if(this.data.user.user_role_id==e)return!1;var n=this;$.ajax({url:"/admin/users/"+this.data.user.id+".json",data:{user:{user_role_id:e}},type:"PUT",success:function(t){console.log(t),n.data.user.user_role_id=e}})},loadListeners:function(){var e=this;this.$el.on("change",".roleSelect",function(t){e.changeRole(parseInt($(this).val()))})},render:function(){return this.$el.html(this.template(this.data)),this}});