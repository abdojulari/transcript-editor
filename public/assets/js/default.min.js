function naturalSort(t,e){var i,n,r=/(^([+\-]?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?(?=\D|\s|$))|^0x[\da-fA-F]+$|\d+)/g,s=/^\s+|\s+$/g,a=/\s+/g,o=/^0x[0-9a-f]+$/i,c=/^0/,l=function(t){return(naturalSort.insensitive&&(""+t).toLowerCase()||""+t).replace(s,"")},u=l(t),h=l(e),d=u.replace(r,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),p=h.replace(r,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),f=parseInt(u.match(o),16)||1!==d.length&&Date.parse(u),v=parseInt(h.match(o),16)||f&&h.match(/(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[\/\-]\d{1,4}[\/\-]\d{1,4}|^\w+, \w+ \d+, \d{4})/)&&Date.parse(h)||null,g=function(t,e){return(!t.match(c)||1==e)&&parseFloat(t)||t.replace(a," ").replace(s,"")||0};if(v){if(f<v)return-1;if(v<f)return 1}for(var m=0,_=d.length,y=p.length,b=Math.max(_,y);m<b;m++){if(i=g(d[m]||"",_),n=g(p[m]||"",y),isNaN(i)!==isNaN(n))return isNaN(i)?1:-1;if(/[^\x00-\x80]/.test(i+n)&&i.localeCompare){var w=i.localeCompare(n);return w/Math.abs(w)}if(i<n)return-1;if(n<i)return 1}}(function(){function t(o){return function(t,e,i,n){e=y(e,n,4);var r=!$(t)&&_.keys(t),s=(r||t).length,a=0<o?0:s-1;return arguments.length<3&&(i=t[r?r[a]:a],a+=o),function(t,e,i,n,r,s){for(;0<=r&&r<s;r+=o){var a=n?n[r]:r;i=e(i,t[a],a,t)}return i}(t,e,i,r,a,s)}}function e(s){return function(t,e,i){e=b(e,i);for(var n=T(t),r=0<s?0:n-1;0<=r&&r<n;r+=s)if(e(t[r],r,t))return r;return-1}}function i(s,a,o){return function(t,e,i){var n=0,r=T(t);if("number"==typeof i)0<s?n=0<=i?i:Math.max(i+r,n):r=0<=i?Math.min(i+1,r):i+r+1;else if(o&&i&&r)return t[i=o(t,e)]===e?i:-1;if(e!=e)return 0<=(i=a(u.call(t,n,r),_.isNaN))?i+n:-1;for(i=0<s?n:r-1;0<=i&&i<r;i+=s)if(t[i]===e)return i;return-1}}function n(t,e){var i=A.length,n=t.constructor,r=_.isFunction(n)&&n.prototype||o,s="constructor";for(_.has(t,s)&&!_.contains(e,s)&&e.push(s);i--;)(s=A[i])in t&&t[s]!==r[s]&&!_.contains(e,s)&&e.push(s)}var r=this,s=r._,a=Array.prototype,o=Object.prototype,c=Function.prototype,l=a.push,u=a.slice,h=o.toString,d=o.hasOwnProperty,p=Array.isArray,f=Object.keys,v=c.bind,g=Object.create,m=function(){},_=function(t){return t instanceof _?t:this instanceof _?void(this._wrapped=t):new _(t)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=_),exports._=_):r._=_,_.VERSION="1.8.3";var y=function(r,s,t){if(void 0===s)return r;switch(null==t?3:t){case 1:return function(t){return r.call(s,t)};case 2:return function(t,e){return r.call(s,t,e)};case 3:return function(t,e,i){return r.call(s,t,e,i)};case 4:return function(t,e,i,n){return r.call(s,t,e,i,n)}}return function(){return r.apply(s,arguments)}},b=function(t,e,i){return null==t?_.identity:_.isFunction(t)?y(t,e,i):_.isObject(t)?_.matcher(t):_.property(t)};_.iteratee=function(t,e){return b(t,e,1/0)};var w=function(c,l){return function(t){var e=arguments.length;if(e<2||null==t)return t;for(var i=1;i<e;i++)for(var n=arguments[i],r=c(n),s=r.length,a=0;a<s;a++){var o=r[a];l&&void 0!==t[o]||(t[o]=n[o])}return t}},x=function(t){if(!_.isObject(t))return{};if(g)return g(t);m.prototype=t;var e=new m;return m.prototype=null,e},k=function(e){return function(t){return null==t?void 0:t[e]}},S=Math.pow(2,53)-1,T=k("length"),$=function(t){var e=T(t);return"number"==typeof e&&0<=e&&e<=S};_.each=_.forEach=function(t,e,i){var n,r;if(e=y(e,i),$(t))for(n=0,r=t.length;n<r;n++)e(t[n],n,t);else{var s=_.keys(t);for(n=0,r=s.length;n<r;n++)e(t[s[n]],s[n],t)}return t},_.map=_.collect=function(t,e,i){e=b(e,i);for(var n=!$(t)&&_.keys(t),r=(n||t).length,s=Array(r),a=0;a<r;a++){var o=n?n[a]:a;s[a]=e(t[o],o,t)}return s},_.reduce=_.foldl=_.inject=t(1),_.reduceRight=_.foldr=t(-1),_.find=_.detect=function(t,e,i){var n;return void 0!==(n=$(t)?_.findIndex(t,e,i):_.findKey(t,e,i))&&-1!==n?t[n]:void 0},_.filter=_.select=function(t,n,e){var r=[];return n=b(n,e),_.each(t,function(t,e,i){n(t,e,i)&&r.push(t)}),r},_.reject=function(t,e,i){return _.filter(t,_.negate(b(e)),i)},_.every=_.all=function(t,e,i){e=b(e,i);for(var n=!$(t)&&_.keys(t),r=(n||t).length,s=0;s<r;s++){var a=n?n[s]:s;if(!e(t[a],a,t))return!1}return!0},_.some=_.any=function(t,e,i){e=b(e,i);for(var n=!$(t)&&_.keys(t),r=(n||t).length,s=0;s<r;s++){var a=n?n[s]:s;if(e(t[a],a,t))return!0}return!1},_.contains=_.includes=_.include=function(t,e,i,n){return $(t)||(t=_.values(t)),("number"!=typeof i||n)&&(i=0),0<=_.indexOf(t,e,i)},_.invoke=function(t,i){var n=u.call(arguments,2),r=_.isFunction(i);return _.map(t,function(t){var e=r?i:t[i];return null==e?e:e.apply(t,n)})},_.pluck=function(t,e){return _.map(t,_.property(e))},_.where=function(t,e){return _.filter(t,_.matcher(e))},_.findWhere=function(t,e){return _.find(t,_.matcher(e))},_.max=function(t,n,e){var i,r,s=-1/0,a=-1/0;if(null==n&&null!=t)for(var o=0,c=(t=$(t)?t:_.values(t)).length;o<c;o++)i=t[o],s<i&&(s=i);else n=b(n,e),_.each(t,function(t,e,i){r=n(t,e,i),(a<r||r===-1/0&&s===-1/0)&&(s=t,a=r)});return s},_.min=function(t,n,e){var i,r,s=1/0,a=1/0;if(null==n&&null!=t)for(var o=0,c=(t=$(t)?t:_.values(t)).length;o<c;o++)(i=t[o])<s&&(s=i);else n=b(n,e),_.each(t,function(t,e,i){((r=n(t,e,i))<a||1/0===r&&1/0===s)&&(s=t,a=r)});return s},_.shuffle=function(t){for(var e,i=$(t)?t:_.values(t),n=i.length,r=Array(n),s=0;s<n;s++)(e=_.random(0,s))!==s&&(r[s]=r[e]),r[e]=i[s];return r},_.sample=function(t,e,i){return null==e||i?($(t)||(t=_.values(t)),t[_.random(t.length-1)]):_.shuffle(t).slice(0,Math.max(0,e))},_.sortBy=function(t,n,e){return n=b(n,e),_.pluck(_.map(t,function(t,e,i){return{value:t,index:e,criteria:n(t,e,i)}}).sort(function(t,e){var i=t.criteria,n=e.criteria;if(i!==n){if(n<i||void 0===i)return 1;if(i<n||void 0===n)return-1}return t.index-e.index}),"value")};var P=function(a){return function(n,r,t){var s={};return r=b(r,t),_.each(n,function(t,e){var i=r(t,e,n);a(s,t,i)}),s}};_.groupBy=P(function(t,e,i){_.has(t,i)?t[i].push(e):t[i]=[e]}),_.indexBy=P(function(t,e,i){t[i]=e}),_.countBy=P(function(t,e,i){_.has(t,i)?t[i]++:t[i]=1}),_.toArray=function(t){return t?_.isArray(t)?u.call(t):$(t)?_.map(t,_.identity):_.values(t):[]},_.size=function(t){return null==t?0:$(t)?t.length:_.keys(t).length},_.partition=function(t,n,e){n=b(n,e);var r=[],s=[];return _.each(t,function(t,e,i){(n(t,e,i)?r:s).push(t)}),[r,s]},_.first=_.head=_.take=function(t,e,i){return null==t?void 0:null==e||i?t[0]:_.initial(t,t.length-e)},_.initial=function(t,e,i){return u.call(t,0,Math.max(0,t.length-(null==e||i?1:e)))},_.last=function(t,e,i){return null==t?void 0:null==e||i?t[t.length-1]:_.rest(t,Math.max(0,t.length-e))},_.rest=_.tail=_.drop=function(t,e,i){return u.call(t,null==e||i?1:e)},_.compact=function(t){return _.filter(t,_.identity)};var C=function(t,e,i,n){for(var r=[],s=0,a=n||0,o=T(t);a<o;a++){var c=t[a];if($(c)&&(_.isArray(c)||_.isArguments(c))){e||(c=C(c,e,i));var l=0,u=c.length;for(r.length+=u;l<u;)r[s++]=c[l++]}else i||(r[s++]=c)}return r};_.flatten=function(t,e){return C(t,e,!1)},_.without=function(t){return _.difference(t,u.call(arguments,1))},_.uniq=_.unique=function(t,e,i,n){_.isBoolean(e)||(n=i,i=e,e=!1),null!=i&&(i=b(i,n));for(var r=[],s=[],a=0,o=T(t);a<o;a++){var c=t[a],l=i?i(c,a,t):c;e?(a&&s===l||r.push(c),s=l):i?_.contains(s,l)||(s.push(l),r.push(c)):_.contains(r,c)||r.push(c)}return r},_.union=function(){return _.uniq(C(arguments,!0,!0))},_.intersection=function(t){for(var e=[],i=arguments.length,n=0,r=T(t);n<r;n++){var s=t[n];if(!_.contains(e,s)){for(var a=1;a<i&&_.contains(arguments[a],s);a++);a===i&&e.push(s)}}return e},_.difference=function(t){var e=C(arguments,!0,!0,1);return _.filter(t,function(t){return!_.contains(e,t)})},_.zip=function(){return _.unzip(arguments)},_.unzip=function(t){for(var e=t&&_.max(t,T).length||0,i=Array(e),n=0;n<e;n++)i[n]=_.pluck(t,n);return i},_.object=function(t,e){for(var i={},n=0,r=T(t);n<r;n++)e?i[t[n]]=e[n]:i[t[n][0]]=t[n][1];return i},_.findIndex=e(1),_.findLastIndex=e(-1),_.sortedIndex=function(t,e,i,n){for(var r=(i=b(i,n,1))(e),s=0,a=T(t);s<a;){var o=Math.floor((s+a)/2);i(t[o])<r?s=o+1:a=o}return s},_.indexOf=i(1,_.findIndex,_.sortedIndex),_.lastIndexOf=i(-1,_.findLastIndex),_.range=function(t,e,i){null==e&&(e=t||0,t=0),i=i||1;for(var n=Math.max(Math.ceil((e-t)/i),0),r=Array(n),s=0;s<n;s++,t+=i)r[s]=t;return r};var I=function(t,e,i,n,r){if(!(n instanceof e))return t.apply(i,r);var s=x(t.prototype),a=t.apply(s,r);return _.isObject(a)?a:s};_.bind=function(t,e){if(v&&t.bind===v)return v.apply(t,u.call(arguments,1));if(!_.isFunction(t))throw new TypeError("Bind must be called on a function");var i=u.call(arguments,2),n=function(){return I(t,n,e,this,i.concat(u.call(arguments)))};return n},_.partial=function(r){var s=u.call(arguments,1),a=function(){for(var t=0,e=s.length,i=Array(e),n=0;n<e;n++)i[n]=s[n]===_?arguments[t++]:s[n];for(;t<arguments.length;)i.push(arguments[t++]);return I(r,a,this,this,i)};return a},_.bindAll=function(t){var e,i,n=arguments.length;if(n<=1)throw new Error("bindAll must be passed function names");for(e=1;e<n;e++)t[i=arguments[e]]=_.bind(t[i],t);return t},_.memoize=function(n,r){var s=function(t){var e=s.cache,i=""+(r?r.apply(this,arguments):t);return _.has(e,i)||(e[i]=n.apply(this,arguments)),e[i]};return s.cache={},s},_.delay=function(t,e){var i=u.call(arguments,2);return setTimeout(function(){return t.apply(null,i)},e)},_.defer=_.partial(_.delay,_,1),_.throttle=function(i,n,r){var s,a,o,c=null,l=0;r||(r={});var u=function(){l=!1===r.leading?0:_.now(),c=null,o=i.apply(s,a),c||(s=a=null)};return function(){var t=_.now();l||!1!==r.leading||(l=t);var e=n-(t-l);return s=this,a=arguments,e<=0||n<e?(c&&(clearTimeout(c),c=null),l=t,o=i.apply(s,a),c||(s=a=null)):c||!1===r.trailing||(c=setTimeout(u,e)),o}},_.debounce=function(e,i,n){var r,s,a,o,c,l=function(){var t=_.now()-o;t<i&&0<=t?r=setTimeout(l,i-t):(r=null,n||(c=e.apply(a,s),r||(a=s=null)))};return function(){a=this,s=arguments,o=_.now();var t=n&&!r;return r||(r=setTimeout(l,i)),t&&(c=e.apply(a,s),a=s=null),c}},_.wrap=function(t,e){return _.partial(e,t)},_.negate=function(t){return function(){return!t.apply(this,arguments)}},_.compose=function(){var i=arguments,n=i.length-1;return function(){for(var t=n,e=i[n].apply(this,arguments);t--;)e=i[t].call(this,e);return e}},_.after=function(t,e){return function(){return--t<1?e.apply(this,arguments):void 0}},_.before=function(t,e){var i;return function(){return 0<--t&&(i=e.apply(this,arguments)),t<=1&&(e=null),i}},_.once=_.partial(_.before,2);var L=!{toString:null}.propertyIsEnumerable("toString"),A=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];_.keys=function(t){if(!_.isObject(t))return[];if(f)return f(t);var e=[];for(var i in t)_.has(t,i)&&e.push(i);return L&&n(t,e),e},_.allKeys=function(t){if(!_.isObject(t))return[];var e=[];for(var i in t)e.push(i);return L&&n(t,e),e},_.values=function(t){for(var e=_.keys(t),i=e.length,n=Array(i),r=0;r<i;r++)n[r]=t[e[r]];return n},_.mapObject=function(t,e,i){e=b(e,i);for(var n,r=_.keys(t),s=r.length,a={},o=0;o<s;o++)a[n=r[o]]=e(t[n],n,t);return a},_.pairs=function(t){for(var e=_.keys(t),i=e.length,n=Array(i),r=0;r<i;r++)n[r]=[e[r],t[e[r]]];return n},_.invert=function(t){for(var e={},i=_.keys(t),n=0,r=i.length;n<r;n++)e[t[i[n]]]=i[n];return e},_.functions=_.methods=function(t){var e=[];for(var i in t)_.isFunction(t[i])&&e.push(i);return e.sort()},_.extend=w(_.allKeys),_.extendOwn=_.assign=w(_.keys),_.findKey=function(t,e,i){e=b(e,i);for(var n,r=_.keys(t),s=0,a=r.length;s<a;s++)if(e(t[n=r[s]],n,t))return n},_.pick=function(t,e,i){var n,r,s={},a=t;if(null==a)return s;_.isFunction(e)?(r=_.allKeys(a),n=y(e,i)):(r=C(arguments,!1,!1,1),n=function(t,e,i){return e in i},a=Object(a));for(var o=0,c=r.length;o<c;o++){var l=r[o],u=a[l];n(u,l,a)&&(s[l]=u)}return s},_.omit=function(t,e,i){if(_.isFunction(e))e=_.negate(e);else{var n=_.map(C(arguments,!1,!1,1),String);e=function(t,e){return!_.contains(n,e)}}return _.pick(t,e,i)},_.defaults=w(_.allKeys,!0),_.create=function(t,e){var i=x(t);return e&&_.extendOwn(i,e),i},_.clone=function(t){return _.isObject(t)?_.isArray(t)?t.slice():_.extend({},t):t},_.tap=function(t,e){return e(t),t},_.isMatch=function(t,e){var i=_.keys(e),n=i.length;if(null==t)return!n;for(var r=Object(t),s=0;s<n;s++){var a=i[s];if(e[a]!==r[a]||!(a in r))return!1}return!0};var E=function(t,e,i,n){if(t===e)return 0!==t||1/t==1/e;if(null==t||null==e)return t===e;t instanceof _&&(t=t._wrapped),e instanceof _&&(e=e._wrapped);var r=h.call(t);if(r!==h.call(e))return!1;switch(r){case"[object RegExp]":case"[object String]":return""+t==""+e;case"[object Number]":return+t!=+t?+e!=+e:0==+t?1/+t==1/e:+t==+e;case"[object Date]":case"[object Boolean]":return+t==+e}var s="[object Array]"===r;if(!s){if("object"!=typeof t||"object"!=typeof e)return!1;var a=t.constructor,o=e.constructor;if(a!==o&&!(_.isFunction(a)&&a instanceof a&&_.isFunction(o)&&o instanceof o)&&"constructor"in t&&"constructor"in e)return!1}n=n||[];for(var c=(i=i||[]).length;c--;)if(i[c]===t)return n[c]===e;if(i.push(t),n.push(e),s){if((c=t.length)!==e.length)return!1;for(;c--;)if(!E(t[c],e[c],i,n))return!1}else{var l,u=_.keys(t);if(c=u.length,_.keys(e).length!==c)return!1;for(;c--;)if(l=u[c],!_.has(e,l)||!E(t[l],e[l],i,n))return!1}return i.pop(),n.pop(),!0};_.isEqual=function(t,e){return E(t,e)},_.isEmpty=function(t){return null==t||($(t)&&(_.isArray(t)||_.isString(t)||_.isArguments(t))?0===t.length:0===_.keys(t).length)},_.isElement=function(t){return!(!t||1!==t.nodeType)},_.isArray=p||function(t){return"[object Array]"===h.call(t)},_.isObject=function(t){var e=typeof t;return"function"===e||"object"===e&&!!t},_.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(e){_["is"+e]=function(t){return h.call(t)==="[object "+e+"]"}}),_.isArguments(arguments)||(_.isArguments=function(t){return _.has(t,"callee")}),"function"!=typeof/./&&"object"!=typeof Int8Array&&(_.isFunction=function(t){return"function"==typeof t||!1}),_.isFinite=function(t){return isFinite(t)&&!isNaN(parseFloat(t))},_.isNaN=function(t){return _.isNumber(t)&&t!==+t},_.isBoolean=function(t){return!0===t||!1===t||"[object Boolean]"===h.call(t)},_.isNull=function(t){return null===t},_.isUndefined=function(t){return void 0===t},_.has=function(t,e){return null!=t&&d.call(t,e)},_.noConflict=function(){return r._=s,this},_.identity=function(t){return t},_.constant=function(t){return function(){return t}},_.noop=function(){},_.property=k,_.propertyOf=function(e){return null==e?function(){}:function(t){return e[t]}},_.matcher=_.matches=function(e){return e=_.extendOwn({},e),function(t){return _.isMatch(t,e)}},_.times=function(t,e,i){var n=Array(Math.max(0,t));e=y(e,i,1);for(var r=0;r<t;r++)n[r]=e(r);return n},_.random=function(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))},_.now=Date.now||function(){return(new Date).getTime()};var M={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},j=_.invert(M),O=function(e){var i=function(t){return e[t]},t="(?:"+_.keys(e).join("|")+")",n=RegExp(t),r=RegExp(t,"g");return function(t){return t=null==t?"":""+t,n.test(t)?t.replace(r,i):t}};_.escape=O(M),_.unescape=O(j),_.result=function(t,e,i){var n=null==t?void 0:t[e];return void 0===n&&(n=i),_.isFunction(n)?n.call(t):n};var F=0;_.uniqueId=function(t){var e=++F+"";return t?t+e:e},_.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var N=/(.)^/,B={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},U=/\\|'|\r|\n|\u2028|\u2029/g,R=function(t){return"\\"+B[t]};_.template=function(s,t,e){!t&&e&&(t=e),t=_.defaults({},t,_.templateSettings);var i=RegExp([(t.escape||N).source,(t.interpolate||N).source,(t.evaluate||N).source].join("|")+"|$","g"),a=0,o="__p+='";s.replace(i,function(t,e,i,n,r){return o+=s.slice(a,r).replace(U,R),a=r+t.length,e?o+="'+\n((__t=("+e+"))==null?'':_.escape(__t))+\n'":i?o+="'+\n((__t=("+i+"))==null?'':__t)+\n'":n&&(o+="';\n"+n+"\n__p+='"),t}),o+="';\n",t.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{var n=new Function(t.variable||"obj","_",o)}catch(t){throw t.source=o,t}var r=function(t){return n.call(this,t,_)},c=t.variable||"obj";return r.source="function("+c+"){\n"+o+"}",r},_.chain=function(t){var e=_(t);return e._chain=!0,e};var D=function(t,e){return t._chain?_(e).chain():e};_.mixin=function(i){_.each(_.functions(i),function(t){var e=_[t]=i[t];_.prototype[t]=function(){var t=[this._wrapped];return l.apply(t,arguments),D(this,e.apply(_,t))}})},_.mixin(_),_.each(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var i=a[e];_.prototype[e]=function(){var t=this._wrapped;return i.apply(t,arguments),"shift"!==e&&"splice"!==e||0!==t.length||delete t[0],D(this,t)}}),_.each(["concat","join","slice"],function(t){var e=a[t];_.prototype[t]=function(){return D(this,e.apply(this._wrapped,arguments))}}),_.prototype.value=function(){return this._wrapped},_.prototype.valueOf=_.prototype.toJSON=_.prototype.value,_.prototype.toString=function(){return""+this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return _})}).call(this),function(n){var r="object"==typeof self&&self.self==self&&self||"object"==typeof global&&global.global==global&&global;if("function"==typeof define&&define.amd)define(["underscore","jquery","exports"],function(t,e,i){r.Backbone=n(r,i,t,e)});else if("undefined"!=typeof exports){var t,e=require("underscore");try{t=require("jquery")}catch(t){}n(r,exports,e,t)}else r.Backbone=n(r,{},r._,r.jQuery||r.Zepto||r.ender||r.$)}(function(t,c,b,e){var i=t.Backbone,s=Array.prototype.slice;c.VERSION="1.2.3",c.$=e,c.noConflict=function(){return t.Backbone=i,this},c.emulateHTTP=!1,c.emulateJSON=!1;var n=function(i,t,n){b.each(t,function(t,e){b[e]&&(i.prototype[e]=function(t,n,r){switch(t){case 1:return function(){return b[n](this[r])};case 2:return function(t){return b[n](this[r],t)};case 3:return function(t,e){return b[n](this[r],a(t,this),e)};case 4:return function(t,e,i){return b[n](this[r],a(t,this),e,i)};default:return function(){var t=s.call(arguments);return t.unshift(this[r]),b[n].apply(b,t)}}}(t,e,n))})},a=function(e,t){return b.isFunction(e)?e:b.isObject(e)&&!t._isModel(e)?r(e):b.isString(e)?function(t){return t.get(e)}:e},r=function(t){var e=b.matches(t);return function(t){return e(t.attributes)}},o=c.Events={},l=/\s+/,u=function(t,e,i,n,r){var s,a=0;if(i&&"object"==typeof i){void 0!==n&&"context"in r&&void 0===r.context&&(r.context=n);for(s=b.keys(i);a<s.length;a++)e=u(t,e,s[a],i[s[a]],r)}else if(i&&l.test(i))for(s=i.split(l);a<s.length;a++)e=t(e,s[a],n,r);else e=t(e,i,n,r);return e};o.on=function(t,e,i){return h(this,t,e,i)};var h=function(t,e,i,n,r){(t._events=u(d,t._events||{},e,i,{context:n,ctx:t,listening:r}),r)&&((t._listeners||(t._listeners={}))[r.id]=r);return t};o.listenTo=function(t,e,i){if(!t)return this;var n=t._listenId||(t._listenId=b.uniqueId("l")),r=this._listeningTo||(this._listeningTo={}),s=r[n];if(!s){var a=this._listenId||(this._listenId=b.uniqueId("l"));s=r[n]={obj:t,objId:n,id:a,listeningTo:r,count:0}}return h(t,e,i,this,s),this};var d=function(t,e,i,n){if(i){var r=t[e]||(t[e]=[]),s=n.context,a=n.ctx,o=n.listening;o&&o.count++,r.push({callback:i,context:s,ctx:s||a,listening:o})}return t};o.off=function(t,e,i){return this._events&&(this._events=u(p,this._events,t,e,{context:i,listeners:this._listeners})),this},o.stopListening=function(t,e,i){var n=this._listeningTo;if(!n)return this;for(var r=t?[t._listenId]:b.keys(n),s=0;s<r.length;s++){var a=n[r[s]];if(!a)break;a.obj.off(e,i,this)}return b.isEmpty(n)&&(this._listeningTo=void 0),this};var p=function(t,e,i,n){if(t){var r,s=0,a=n.context,o=n.listeners;if(e||i||a){for(var c=e?[e]:b.keys(t);s<c.length;s++){var l=t[e=c[s]];if(!l)break;for(var u=[],h=0;h<l.length;h++){var d=l[h];i&&i!==d.callback&&i!==d.callback._callback||a&&a!==d.context?u.push(d):(r=d.listening)&&0==--r.count&&(delete o[r.id],delete r.listeningTo[r.objId])}u.length?t[e]=u:delete t[e]}return b.size(t)?t:void 0}for(var p=b.keys(o);s<p.length;s++)delete o[(r=o[p[s]]).id],delete r.listeningTo[r.objId]}};o.once=function(t,e,i){var n=u(f,{},t,e,b.bind(this.off,this));return this.on(n,void 0,i)},o.listenToOnce=function(t,e,i){var n=u(f,{},e,i,b.bind(this.stopListening,this,t));return this.listenTo(t,n)};var f=function(t,e,i,n){if(i){var r=t[e]=b.once(function(){n(e,r),i.apply(this,arguments)});r._callback=i}return t};o.trigger=function(t){if(!this._events)return this;for(var e=Math.max(0,arguments.length-1),i=Array(e),n=0;n<e;n++)i[n]=arguments[n+1];return u(v,this._events,t,void 0,i),this};var v=function(t,e,i,n){if(t){var r=t[e],s=t.all;r&&s&&(s=s.slice()),r&&g(r,n),s&&g(s,[e].concat(n))}return t},g=function(t,e){var i,n=-1,r=t.length,s=e[0],a=e[1],o=e[2];switch(e.length){case 0:for(;++n<r;)(i=t[n]).callback.call(i.ctx);return;case 1:for(;++n<r;)(i=t[n]).callback.call(i.ctx,s);return;case 2:for(;++n<r;)(i=t[n]).callback.call(i.ctx,s,a);return;case 3:for(;++n<r;)(i=t[n]).callback.call(i.ctx,s,a,o);return;default:for(;++n<r;)(i=t[n]).callback.apply(i.ctx,e);return}};o.bind=o.on,o.unbind=o.off,b.extend(c,o);var m=c.Model=function(t,e){var i=t||{};e||(e={}),this.cid=b.uniqueId(this.cidPrefix),this.attributes={},e.collection&&(this.collection=e.collection),e.parse&&(i=this.parse(i,e)||{}),i=b.defaults({},i,b.result(this,"defaults")),this.set(i,e),this.changed={},this.initialize.apply(this,arguments)};b.extend(m.prototype,o,{changed:null,validationError:null,idAttribute:"id",cidPrefix:"c",initialize:function(){},toJSON:function(t){return b.clone(this.attributes)},sync:function(){return c.sync.apply(this,arguments)},get:function(t){return this.attributes[t]},escape:function(t){return b.escape(this.get(t))},has:function(t){return null!=this.get(t)},matches:function(t){return!!b.iteratee(t,this)(this.attributes)},set:function(t,e,i){if(null==t)return this;var n;if("object"==typeof t?(n=t,i=e):(n={})[t]=e,i||(i={}),!this._validate(n,i))return!1;var r=i.unset,s=i.silent,a=[],o=this._changing;this._changing=!0,o||(this._previousAttributes=b.clone(this.attributes),this.changed={});var c=this.attributes,l=this.changed,u=this._previousAttributes;for(var h in n)e=n[h],b.isEqual(c[h],e)||a.push(h),b.isEqual(u[h],e)?delete l[h]:l[h]=e,r?delete c[h]:c[h]=e;if(this.id=this.get(this.idAttribute),!s){a.length&&(this._pending=i);for(var d=0;d<a.length;d++)this.trigger("change:"+a[d],this,c[a[d]],i)}if(o)return this;if(!s)for(;this._pending;)i=this._pending,this._pending=!1,this.trigger("change",this,i);return this._pending=!1,this._changing=!1,this},unset:function(t,e){return this.set(t,void 0,b.extend({},e,{unset:!0}))},clear:function(t){var e={};for(var i in this.attributes)e[i]=void 0;return this.set(e,b.extend({},t,{unset:!0}))},hasChanged:function(t){return null==t?!b.isEmpty(this.changed):b.has(this.changed,t)},changedAttributes:function(t){if(!t)return!!this.hasChanged()&&b.clone(this.changed);var e=this._changing?this._previousAttributes:this.attributes,i={};for(var n in t){var r=t[n];b.isEqual(e[n],r)||(i[n]=r)}return!!b.size(i)&&i},previous:function(t){return null!=t&&this._previousAttributes?this._previousAttributes[t]:null},previousAttributes:function(){return b.clone(this._previousAttributes)},fetch:function(i){i=b.extend({parse:!0},i);var n=this,r=i.success;return i.success=function(t){var e=i.parse?n.parse(t,i):t;if(!n.set(e,i))return!1;r&&r.call(i.context,n,t,i),n.trigger("sync",n,t,i)},N(this,i),this.sync("read",this,i)},save:function(t,e,i){var n;null==t||"object"==typeof t?(n=t,i=e):(n={})[t]=e;var r=(i=b.extend({validate:!0,parse:!0},i)).wait;if(n&&!r){if(!this.set(n,i))return!1}else if(!this._validate(n,i))return!1;var s=this,a=i.success,o=this.attributes;i.success=function(t){s.attributes=o;var e=i.parse?s.parse(t,i):t;if(r&&(e=b.extend({},n,e)),e&&!s.set(e,i))return!1;a&&a.call(i.context,s,t,i),s.trigger("sync",s,t,i)},N(this,i),n&&r&&(this.attributes=b.extend({},o,n));var c=this.isNew()?"create":i.patch?"patch":"update";"patch"!==c||i.attrs||(i.attrs=n);var l=this.sync(c,this,i);return this.attributes=o,l},destroy:function(e){e=e?b.clone(e):{};var i=this,n=e.success,r=e.wait,s=function(){i.stopListening(),i.trigger("destroy",i,i.collection,e)},t=!(e.success=function(t){r&&s(),n&&n.call(e.context,i,t,e),i.isNew()||i.trigger("sync",i,t,e)});return this.isNew()?b.defer(e.success):(N(this,e),t=this.sync("delete",this,e)),r||s(),t},url:function(){var t=b.result(this,"urlRoot")||b.result(this.collection,"url")||F();if(this.isNew())return t;var e=this.get(this.idAttribute);return t.replace(/[^\/]$/,"$&/")+encodeURIComponent(e)},parse:function(t,e){return t},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(t){return this._validate({},b.defaults({validate:!0},t))},_validate:function(t,e){if(!e.validate||!this.validate)return!0;t=b.extend({},this.attributes,t);var i=this.validationError=this.validate(t,e)||null;return!i||(this.trigger("invalid",this,i,b.extend(e,{validationError:i})),!1)}});n(m,{keys:1,values:1,pairs:1,invert:1,pick:0,omit:0,chain:1,isEmpty:1},"attributes");var _=c.Collection=function(t,e){e||(e={}),e.model&&(this.model=e.model),void 0!==e.comparator&&(this.comparator=e.comparator),this._reset(),this.initialize.apply(this,arguments),t&&this.reset(t,b.extend({silent:!0},e))},w={add:!0,remove:!0,merge:!0},y={add:!0,remove:!1},x=function(t,e,i){i=Math.min(Math.max(i,0),t.length);for(var n=Array(t.length-i),r=e.length,s=0;s<n.length;s++)n[s]=t[s+i];for(s=0;s<r;s++)t[s+i]=e[s];for(s=0;s<n.length;s++)t[s+r+i]=n[s]};b.extend(_.prototype,o,{model:m,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return c.sync.apply(this,arguments)},add:function(t,e){return this.set(t,b.extend({merge:!1},e,y))},remove:function(t,e){e=b.extend({},e);var i=!b.isArray(t);t=i?[t]:b.clone(t);var n=this._removeModels(t,e);return!e.silent&&n&&this.trigger("update",this,e),i?n[0]:n},set:function(t,e){if(null!=t){(e=b.defaults({},e,w)).parse&&!this._isModel(t)&&(t=this.parse(t,e));var i=!b.isArray(t);t=i?[t]:t.slice();var n=e.at;null!=n&&(n=+n),n<0&&(n+=this.length+1);for(var r,s=[],a=[],o=[],c={},l=e.add,u=e.merge,h=e.remove,d=!1,p=this.comparator&&null==n&&!1!==e.sort,f=b.isString(this.comparator)?this.comparator:null,v=0;v<t.length;v++){r=t[v];var g=this.get(r);if(g){if(u&&r!==g){var m=this._isModel(r)?r.attributes:r;e.parse&&(m=g.parse(m,e)),g.set(m,e),p&&!d&&(d=g.hasChanged(f))}c[g.cid]||(c[g.cid]=!0,s.push(g)),t[v]=g}else l&&(r=t[v]=this._prepareModel(r,e))&&(a.push(r),this._addReference(r,e),c[r.cid]=!0,s.push(r))}if(h){for(v=0;v<this.length;v++)c[(r=this.models[v]).cid]||o.push(r);o.length&&this._removeModels(o,e)}var _=!1,y=!p&&l&&h;if(s.length&&y?(_=this.length!=s.length||b.some(this.models,function(t,e){return t!==s[e]}),this.models.length=0,x(this.models,s,0),this.length=this.models.length):a.length&&(p&&(d=!0),x(this.models,a,null==n?this.length:n),this.length=this.models.length),d&&this.sort({silent:!0}),!e.silent){for(v=0;v<a.length;v++)null!=n&&(e.index=n+v),(r=a[v]).trigger("add",r,this,e);(d||_)&&this.trigger("sort",this,e),(a.length||o.length)&&this.trigger("update",this,e)}return i?t[0]:t}},reset:function(t,e){e=e?b.clone(e):{};for(var i=0;i<this.models.length;i++)this._removeReference(this.models[i],e);return e.previousModels=this.models,this._reset(),t=this.add(t,b.extend({silent:!0},e)),e.silent||this.trigger("reset",this,e),t},push:function(t,e){return this.add(t,b.extend({at:this.length},e))},pop:function(t){var e=this.at(this.length-1);return this.remove(e,t)},unshift:function(t,e){return this.add(t,b.extend({at:0},e))},shift:function(t){var e=this.at(0);return this.remove(e,t)},slice:function(){return s.apply(this.models,arguments)},get:function(t){if(null!=t){var e=this.modelId(this._isModel(t)?t.attributes:t);return this._byId[t]||this._byId[e]||this._byId[t.cid]}},at:function(t){return t<0&&(t+=this.length),this.models[t]},where:function(t,e){return this[e?"find":"filter"](t)},findWhere:function(t){return this.where(t,!0)},sort:function(t){var e=this.comparator;if(!e)throw new Error("Cannot sort a set without a comparator");t||(t={});var i=e.length;return b.isFunction(e)&&(e=b.bind(e,this)),1===i||b.isString(e)?this.models=this.sortBy(e):this.models.sort(e),t.silent||this.trigger("sort",this,t),this},pluck:function(t){return b.invoke(this.models,"get",t)},fetch:function(i){var n=(i=b.extend({parse:!0},i)).success,r=this;return i.success=function(t){var e=i.reset?"reset":"set";r[e](t,i),n&&n.call(i.context,r,t,i),r.trigger("sync",r,t,i)},N(this,i),this.sync("read",this,i)},create:function(t,e){var n=(e=e?b.clone(e):{}).wait;if(!(t=this._prepareModel(t,e)))return!1;n||this.add(t,e);var r=this,s=e.success;return e.success=function(t,e,i){n&&r.add(t,i),s&&s.call(i.context,t,e,i)},t.save(null,e),t},parse:function(t,e){return t},clone:function(){return new this.constructor(this.models,{model:this.model,comparator:this.comparator})},modelId:function(t){return t[this.model.prototype.idAttribute||"id"]},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(t,e){if(this._isModel(t))return t.collection||(t.collection=this),t;var i=new(((e=e?b.clone(e):{}).collection=this).model)(t,e);return i.validationError?(this.trigger("invalid",this,i.validationError,e),!1):i},_removeModels:function(t,e){for(var i=[],n=0;n<t.length;n++){var r=this.get(t[n]);if(r){var s=this.indexOf(r);this.models.splice(s,1),this.length--,e.silent||(e.index=s,r.trigger("remove",r,this,e)),i.push(r),this._removeReference(r,e)}}return!!i.length&&i},_isModel:function(t){return t instanceof m},_addReference:function(t,e){this._byId[t.cid]=t;var i=this.modelId(t.attributes);null!=i&&(this._byId[i]=t),t.on("all",this._onModelEvent,this)},_removeReference:function(t,e){delete this._byId[t.cid];var i=this.modelId(t.attributes);null!=i&&delete this._byId[i],this===t.collection&&delete t.collection,t.off("all",this._onModelEvent,this)},_onModelEvent:function(t,e,i,n){if("add"!==t&&"remove"!==t||i===this){if("destroy"===t&&this.remove(e,n),"change"===t){var r=this.modelId(e.previousAttributes()),s=this.modelId(e.attributes);r!==s&&(null!=r&&delete this._byId[r],null!=s&&(this._byId[s]=e))}this.trigger.apply(this,arguments)}}});n(_,{forEach:3,each:3,map:3,collect:3,reduce:4,foldl:4,inject:4,reduceRight:4,foldr:4,find:3,detect:3,filter:3,select:3,reject:3,every:3,all:3,some:3,any:3,include:3,includes:3,contains:3,invoke:0,max:3,min:3,toArray:1,size:1,first:3,head:3,take:3,initial:3,rest:3,tail:3,drop:3,last:3,without:0,difference:0,indexOf:3,shuffle:1,lastIndexOf:3,isEmpty:1,chain:1,sample:3,partition:3,groupBy:3,countBy:3,sortBy:3,indexBy:3},"models");var k=c.View=function(t){this.cid=b.uniqueId("view"),b.extend(this,b.pick(t,T)),this._ensureElement(),this.initialize.apply(this,arguments)},S=/^(\S+)\s*(.*)$/,T=["model","collection","el","id","attributes","className","tagName","events"];b.extend(k.prototype,o,{tagName:"div",$:function(t){return this.$el.find(t)},initialize:function(){},render:function(){return this},remove:function(){return this._removeElement(),this.stopListening(),this},_removeElement:function(){this.$el.remove()},setElement:function(t){return this.undelegateEvents(),this._setElement(t),this.delegateEvents(),this},_setElement:function(t){this.$el=t instanceof c.$?t:c.$(t),this.el=this.$el[0]},delegateEvents:function(t){if(t||(t=b.result(this,"events")),!t)return this;for(var e in this.undelegateEvents(),t){var i=t[e];if(b.isFunction(i)||(i=this[i]),i){var n=e.match(S);this.delegate(n[1],n[2],b.bind(i,this))}}return this},delegate:function(t,e,i){return this.$el.on(t+".delegateEvents"+this.cid,e,i),this},undelegateEvents:function(){return this.$el&&this.$el.off(".delegateEvents"+this.cid),this},undelegate:function(t,e,i){return this.$el.off(t+".delegateEvents"+this.cid,e,i),this},_createElement:function(t){return document.createElement(t)},_ensureElement:function(){if(this.el)this.setElement(b.result(this,"el"));else{var t=b.extend({},b.result(this,"attributes"));this.id&&(t.id=b.result(this,"id")),this.className&&(t.class=b.result(this,"className")),this.setElement(this._createElement(b.result(this,"tagName"))),this._setAttributes(t)}},_setAttributes:function(t){this.$el.attr(t)}}),c.sync=function(t,e,n){var i=$[t];b.defaults(n||(n={}),{emulateHTTP:c.emulateHTTP,emulateJSON:c.emulateJSON});var r={type:i,dataType:"json"};if(n.url||(r.url=b.result(e,"url")||F()),null!=n.data||!e||"create"!==t&&"update"!==t&&"patch"!==t||(r.contentType="application/json",r.data=JSON.stringify(n.attrs||e.toJSON(n))),n.emulateJSON&&(r.contentType="application/x-www-form-urlencoded",r.data=r.data?{model:r.data}:{}),n.emulateHTTP&&("PUT"===i||"DELETE"===i||"PATCH"===i)){r.type="POST",n.emulateJSON&&(r.data._method=i);var s=n.beforeSend;n.beforeSend=function(t){if(t.setRequestHeader("X-HTTP-Method-Override",i),s)return s.apply(this,arguments)}}"GET"===r.type||n.emulateJSON||(r.processData=!1);var a=n.error;n.error=function(t,e,i){n.textStatus=e,n.errorThrown=i,a&&a.call(n.context,t,e,i)};var o=n.xhr=c.ajax(b.extend(r,n));return e.trigger("request",e,o,n),o};var $={create:"POST",update:"PUT",patch:"PATCH",delete:"DELETE",read:"GET"};c.ajax=function(){return c.$.ajax.apply(c.$,arguments)};var P=c.Router=function(t){t||(t={}),t.routes&&(this.routes=t.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},C=/\((.*?)\)/g,I=/(\(\?)?:\w+/g,L=/\*\w+/g,A=/[\-{}\[\]+?.,\\\^$|#\s]/g;b.extend(P.prototype,o,{initialize:function(){},route:function(i,n,r){b.isRegExp(i)||(i=this._routeToRegExp(i)),b.isFunction(n)&&(r=n,n=""),r||(r=this[n]);var s=this;return c.history.route(i,function(t){var e=s._extractParameters(i,t);!1!==s.execute(r,e,n)&&(s.trigger.apply(s,["route:"+n].concat(e)),s.trigger("route",n,e),c.history.trigger("route",s,n,e))}),this},execute:function(t,e,i){t&&t.apply(this,e)},navigate:function(t,e){return c.history.navigate(t,e),this},_bindRoutes:function(){if(this.routes){this.routes=b.result(this,"routes");for(var t,e=b.keys(this.routes);null!=(t=e.pop());)this.route(t,this.routes[t])}},_routeToRegExp:function(t){return t=t.replace(A,"\\$&").replace(C,"(?:$1)?").replace(I,function(t,e){return e?t:"([^/?]+)"}).replace(L,"([^?]*?)"),new RegExp("^"+t+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(t,e){var i=t.exec(e).slice(1);return b.map(i,function(t,e){return e===i.length-1?t||null:t?decodeURIComponent(t):null})}});var E=c.History=function(){this.handlers=[],this.checkUrl=b.bind(this.checkUrl,this),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},M=/^[#\/]|\s+$/g,j=/^\/+|\/+$/g,O=/#.*$/;E.started=!1,b.extend(E.prototype,o,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root&&!this.getSearch()},matchRoot:function(){return this.decodeFragment(this.location.pathname).slice(0,this.root.length-1)+"/"===this.root},decodeFragment:function(t){return decodeURI(t.replace(/%25/g,"%2525"))},getSearch:function(){var t=this.location.href.replace(/#.*/,"").match(/\?.+/);return t?t[0]:""},getHash:function(t){var e=(t||this).location.href.match(/#(.*)$/);return e?e[1]:""},getPath:function(){var t=this.decodeFragment(this.location.pathname+this.getSearch()).slice(this.root.length-1);return"/"===t.charAt(0)?t.slice(1):t},getFragment:function(t){return null==t&&(t=this._usePushState||!this._wantsHashChange?this.getPath():this.getHash()),t.replace(M,"")},start:function(t){if(E.started)throw new Error("Backbone.history has already been started");if(E.started=!0,this.options=b.extend({root:"/"},this.options,t),this.root=this.options.root,this._wantsHashChange=!1!==this.options.hashChange,this._hasHashChange="onhashchange"in window&&(void 0===document.documentMode||7<document.documentMode),this._useHashChange=this._wantsHashChange&&this._hasHashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!(!this.history||!this.history.pushState),this._usePushState=this._wantsPushState&&this._hasPushState,this.fragment=this.getFragment(),this.root=("/"+this.root+"/").replace(j,"/"),this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot()){var e=this.root.slice(0,-1)||"/";return this.location.replace(e+"#"+this.getPath()),!0}this._hasPushState&&this.atRoot()&&this.navigate(this.getHash(),{replace:!0})}if(!this._hasHashChange&&this._wantsHashChange&&!this._usePushState){this.iframe=document.createElement("iframe"),this.iframe.src="javascript:0",this.iframe.style.display="none",this.iframe.tabIndex=-1;var i=document.body,n=i.insertBefore(this.iframe,i.firstChild).contentWindow;n.document.open(),n.document.close(),n.location.hash="#"+this.fragment}var r=window.addEventListener||function(t,e){return attachEvent("on"+t,e)};if(this._usePushState?r("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe?r("hashchange",this.checkUrl,!1):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),!this.options.silent)return this.loadUrl()},stop:function(){var t=window.removeEventListener||function(t,e){return detachEvent("on"+t,e)};this._usePushState?t("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe&&t("hashchange",this.checkUrl,!1),this.iframe&&(document.body.removeChild(this.iframe),this.iframe=null),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),E.started=!1},route:function(t,e){this.handlers.unshift({route:t,callback:e})},checkUrl:function(t){var e=this.getFragment();if(e===this.fragment&&this.iframe&&(e=this.getHash(this.iframe.contentWindow)),e===this.fragment)return!1;this.iframe&&this.navigate(e),this.loadUrl()},loadUrl:function(e){return!!this.matchRoot()&&(e=this.fragment=this.getFragment(e),b.some(this.handlers,function(t){if(t.route.test(e))return t.callback(e),!0}))},navigate:function(t,e){if(!E.started)return!1;e&&!0!==e||(e={trigger:!!e}),t=this.getFragment(t||"");var i=this.root;""!==t&&"?"!==t.charAt(0)||(i=i.slice(0,-1)||"/");var n=i+t;if(t=this.decodeFragment(t.replace(O,"")),this.fragment!==t){if(this.fragment=t,this._usePushState)this.history[e.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);if(this._updateHash(this.location,t,e.replace),this.iframe&&t!==this.getHash(this.iframe.contentWindow)){var r=this.iframe.contentWindow;e.replace||(r.document.open(),r.document.close()),this._updateHash(r.location,t,e.replace)}}return e.trigger?this.loadUrl(t):void 0}},_updateHash:function(t,e,i){if(i){var n=t.href.replace(/(javascript:|#).*$/,"");t.replace(n+"#"+e)}else t.hash="#"+e}}),c.history=new E;m.extend=_.extend=P.extend=k.extend=E.extend=function(t,e){var i,n=this;i=t&&b.has(t,"constructor")?t.constructor:function(){return n.apply(this,arguments)},b.extend(i,n,e);var r=function(){this.constructor=i};return r.prototype=n.prototype,i.prototype=new r,t&&b.extend(i.prototype,t),i.__super__=n.prototype,i};var F=function(){throw new Error('A "url" property or function must be specified')},N=function(e,i){var n=i.error;i.error=function(t){n&&n.call(i.context,e,t,i),e.trigger("error",e,t,i)}};return c}),function(t){"function"==typeof define&&define.amd?define(["backbone","underscore"],t):"object"==typeof exports?module.exports=t(require("backbone"),require("underscore")):t(window.Backbone,window._)}(function(t,r){var s=t.Router.prototype.route,a=function(){};r.extend(t.Router.prototype,{before:a,after:a,route:function(e,t,i){i||(i=this[t]);var n=r.bind(function(){var t=[e,r.toArray(arguments)];!1!==(r.isFunction(this.before)?this.before:void 0!==this.before[e]?this.before[e]:a).apply(this,t)&&(i&&i.apply(this,arguments),(r.isFunction(this.after)?this.after:void 0!==this.after[e]?this.after[e]:a).apply(this,t))},this);return s.call(this,e,t,n)}})}),function(t){var e=!1;if("function"==typeof define&&define.amd&&(define(t),e=!0),"object"==typeof exports&&(module.exports=t(),e=!0),!e){var i=window.Cookies,n=window.Cookies=t();n.noConflict=function(){return window.Cookies=i,n}}}(function(){function v(){for(var t=0,e={};t<arguments.length;t++){var i=arguments[t];for(var n in i)e[n]=i[n]}return e}return function t(p){function f(t,e,i){var n;if("undefined"!=typeof document){if(1<arguments.length){if("number"==typeof(i=v({path:"/"},f.defaults,i)).expires){var r=new Date;r.setMilliseconds(r.getMilliseconds()+864e5*i.expires),i.expires=r}i.expires=i.expires?i.expires.toUTCString():"";try{n=JSON.stringify(e),/^[\{\[]/.test(n)&&(e=n)}catch(t){}e=p.write?p.write(e,t):encodeURIComponent(String(e)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=(t=(t=encodeURIComponent(String(t))).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent)).replace(/[\(\)]/g,escape);var s="";for(var a in i)i[a]&&(s+="; "+a,!0!==i[a]&&(s+="="+i[a]));return document.cookie=t+"="+e+s}t||(n={});for(var o=document.cookie?document.cookie.split("; "):[],c=/(%[0-9A-Z]{2})+/g,l=0;l<o.length;l++){var u=o[l].split("="),h=u.slice(1).join("=");this.json||'"'!==h.charAt(0)||(h=h.slice(1,-1));try{var d=u[0].replace(c,decodeURIComponent);if(h=p.read?p.read(h,d):p(h,d)||h.replace(c,decodeURIComponent),this.json)try{h=JSON.parse(h)}catch(t){}if(t===d){n=h;break}t||(n[d]=h)}catch(t){}}return n}}return(f.set=f).get=function(t){return f.call(f,t)},f.getJSON=function(){return f.apply({json:!0},[].slice.call(arguments))},f.defaults={},f.remove=function(t,e){f(t,"",v(e,{expires:-1}))},f.withConverter=t,f}(function(){})}),function(xr){if("function"==typeof require&&"object"==typeof exports&&"object"==typeof module){try{var yr=require("jquery")}catch(t){}module.exports=xr(yr)}else if("function"==typeof define&&define.amd)define(["jquery"],function(t){return xr(t)});else{var zr;try{zr=eval("this")}catch(t){zr=window}zr.deparam=xr(zr.jQuery)}}(function(t){var e=function(t,c){var l={},u={true:!0,false:!1,null:null};return t.replace(/\+/g," ").split("&").forEach(function(t){var e,i=t.split("="),n=decodeURIComponent(i[0]),r=l,s=0,a=n.split("]["),o=a.length-1;if(/\[/.test(a[0])&&/\]$/.test(a[o])?(a[o]=a[o].replace(/\]$/,""),o=(a=a.shift().split("[").concat(a)).length-1):o=0,2===i.length)if(e=decodeURIComponent(i[1]),c&&(e=e&&!isNaN(e)&&+e+""===e?+e:"undefined"===e?void 0:void 0!==u[e]?u[e]:e),o)for(;s<=o;s++)r=r[n=""===a[s]?r.length:a[s]]=s<o?r[n]||(a[s+1]&&isNaN(a[s+1])?{}:[]):e;else"[object Array]"===Object.prototype.toString.call(l[n])?l[n].push(e):!{}.hasOwnProperty.call(l,n)?l[n]=e:l[n]=[l[n],e];else n&&(l[n]=c?void 0:"")}),l};return t&&(t.prototype.deparam=t.deparam=e),e}),function(t,e){"object"==typeof exports&&module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.PubSub=e()}("object"==typeof window&&window||this,function(){var i={},c={},n=-1;function l(t){var e;for(e in t)if(t.hasOwnProperty(e))return!0;return!1}function o(t,e,i){try{t(e,i)}catch(t){setTimeout((n=t,function(){throw n}),0)}var n}function u(t,e,i){t(e,i)}function h(t,e,i,n){var r,s=c[e],a=n?u:o;if(c.hasOwnProperty(e))for(r in s)s.hasOwnProperty(r)&&a(s[r],t,i)}function r(t,e,i,n){var r,s,a,o=(r=t,s=e,a=n,function(){var t=String(r),e=t.lastIndexOf(".");for(h(r,r,s,a);-1!==e;)e=(t=t.substr(0,e)).lastIndexOf("."),h(r,t,s)});return!!function(t){for(var e=String(t),i=Boolean(c.hasOwnProperty(e)&&l(c[e])),n=e.lastIndexOf(".");!i&&-1!==n;)n=(e=e.substr(0,n)).lastIndexOf("."),i=Boolean(c.hasOwnProperty(e)&&l(c[e]));return i}(t)&&(!0===i?o():setTimeout(o,0),!0)}return i.publish=function(t,e){return r(t,e,!1,i.immediateExceptions)},i.publishSync=function(t,e){return r(t,e,!0,i.immediateExceptions)},i.subscribe=function(t,e){if("function"!=typeof e)return!1;c.hasOwnProperty(t)||(c[t]={});var i="uid_"+String(++n);return c[t][i]=e,i},i.unsubscribe=function(t){var e,i,n,r="string"==typeof t,s=!1;for(e in c)if(c.hasOwnProperty(e)){if(i=c[e],r&&i[t]){delete i[t],s=t;break}if(!r)for(n in i)i.hasOwnProperty(n)&&i[n]===t&&(delete i[n],s=!0)}return s},i}),function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("Fuse",[],e):"object"==typeof exports?exports.Fuse=e():t.Fuse=e()}(this,function(){return function(i){function n(t){if(r[t])return r[t].exports;var e=r[t]={i:t,l:!1,exports:{}};return i[t].call(e.exports,e,e.exports,n),e.l=!0,e.exports}var r={};return n.m=i,n.c=r,n.i=function(t){return t},n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:i})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=8)}([function(t,e,i){"use strict";t.exports=function(t){return"[object Array]"===Object.prototype.toString.call(t)}},function(t,e,i){"use strict";var n=function(){function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}}(),u=i(5),h=i(7),y=i(4),r=function(){function _(t,e){var i=e.location,n=void 0===i?0:i,r=e.distance,s=void 0===r?100:r,a=e.threshold,o=void 0===a?.6:a,c=e.maxPatternLength,l=void 0===c?32:c,u=e.isCaseSensitive,h=void 0!==u&&u,d=e.tokenSeparator,p=void 0===d?/ +/g:d,f=e.findAllMatches,v=void 0!==f&&f,g=e.minMatchCharLength,m=void 0===g?1:g;(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,_),this.options={location:n,distance:s,threshold:o,maxPatternLength:l,isCaseSensitive:h,tokenSeparator:p,findAllMatches:v,minMatchCharLength:m},this.pattern=this.options.isCaseSensitive?t:t.toLowerCase(),this.pattern.length<=l&&(this.patternAlphabet=y(this.pattern))}return n(_,[{key:"search",value:function(t){if(this.options.isCaseSensitive||(t=t.toLowerCase()),this.pattern===t)return{isMatch:!0,score:0,matchedIndices:[[0,t.length-1]]};var e=this.options,i=e.maxPatternLength,n=e.tokenSeparator;if(this.pattern.length>i)return u(t,this.pattern,n);var r=this.options,s=r.location,a=r.distance,o=r.threshold,c=r.findAllMatches,l=r.minMatchCharLength;return h(t,this.pattern,this.patternAlphabet,{location:s,distance:a,threshold:o,findAllMatches:c,minMatchCharLength:l})}}]),_}();t.exports=r},function(t,e,i){"use strict";var u=i(0);t.exports=function(t,e){return function t(e,i,n){if(i){var r=i.indexOf("."),s=i,a=null;-1!==r&&(s=i.slice(0,r),a=i.slice(r+1));var o=e[s];if(null!=o)if(a||"string"!=typeof o&&"number"!=typeof o)if(u(o))for(var c=0,l=o.length;c<l;c+=1)t(o[c],a,n);else a&&t(o,a,n);else n.push(o)}else n.push(e);return n}(t,e,[])}},function(t,e,i){"use strict";t.exports=function(){for(var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,i=[],n=-1,r=-1,s=0,a=t.length;s<a;s+=1){var o=t[s];o&&-1===n?n=s:o||-1===n||(e<=(r=s-1)-n+1&&i.push([n,r]),n=-1)}return t[s-1]&&e<=s-n&&i.push([n,s-1]),i}},function(t,e,i){"use strict";t.exports=function(t){for(var e={},i=t.length,n=0;n<i;n+=1)e[t.charAt(n)]=0;for(var r=0;r<i;r+=1)e[t.charAt(r)]|=1<<i-r-1;return e}},function(t,e,i){"use strict";t.exports=function(t,e){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:/ +/g,n=t.match(new RegExp(e.replace(i,"|"))),r=!!n,s=[];if(r)for(var a=0,o=n.length;a<o;a+=1)match=n[a],s.push([t.indexOf(match),match.length-1]);return{score:r?.5:1,isMatch:r,matchedIndices:s}}},function(t,e,i){"use strict";t.exports=function(t,e){var i=e.errors,n=void 0===i?0:i,r=e.currentLocation,s=void 0===r?0:r,a=e.expectedLocation,o=void 0===a?0:a,c=e.distance,l=void 0===c?100:c,u=n/t.length,h=Math.abs(o-s);return l?u+h/l:h?1:u}},function(t,e,i){"use strict";var F=i(6),N=i(3);t.exports=function(t,e,i,n){for(var r=n.location,s=void 0===r?0:r,a=n.distance,o=void 0===a?100:a,c=n.threshold,l=void 0===c?.6:c,u=n.findAllMatches,h=void 0!==u&&u,d=n.minMatchCharLength,p=void 0===d?1:d,f=s,v=t.length,g=l,m=t.indexOf(e,f),_=e.length,y=[],b=0;b<v;b+=1)y[b]=0;if(-1!=m){var w=F(e,{errors:0,currentLocation:m,expectedLocation:f,distance:o});if(g=Math.min(w,g),-1!=(m=t.lastIndexOf(e,f+_))){var x=F(e,{errors:0,currentLocation:m,expectedLocation:f,distance:o});g=Math.min(x,g)}}m=-1;for(var k=[],S=1,T=_+v,$=1<<_-1,P=0;P<_;P+=1){for(var C=0,I=T;C<I;)F(e,{errors:P,currentLocation:f+I,expectedLocation:f,distance:o})<=g?C=I:T=I,I=Math.floor((T-C)/2+C);T=I;var L=Math.max(1,f-I+1),A=h?v:Math.min(f+I,v)+_,E=Array(A+2);E[A+1]=(1<<P)-1;for(var M=A;L<=M;M-=1){var j=M-1,O=i[t.charAt(j)];if(O&&(y[j]=1),E[M]=(E[M+1]<<1|1)&O,0!==P&&(E[M]|=(k[M+1]|k[M])<<1|1|k[M+1]),E[M]&$&&(S=F(e,{errors:P,currentLocation:j,expectedLocation:f,distance:o}))<=g){if(g=S,(m=j)<=f)break;L=Math.max(1,2*f-m)}}if(F(e,{errors:P+1,currentLocation:f,expectedLocation:f,distance:o})>g)break;k=E}return{isMatch:0<=m,score:0===S?.001:S,matchedIndices:N(y,p)}}},function(t,e,i){"use strict";var n=function(){function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}}(),s=i(1),U=i(2),j=i(0),r=function(){function B(t,e){var i=e.location,n=void 0===i?0:i,r=e.distance,s=void 0===r?100:r,a=e.threshold,o=void 0===a?.6:a,c=e.maxPatternLength,l=void 0===c?32:c,u=e.caseSensitive,h=void 0!==u&&u,d=e.tokenSeparator,p=void 0===d?/ +/g:d,f=e.findAllMatches,v=void 0!==f&&f,g=e.minMatchCharLength,m=void 0===g?1:g,_=e.id,y=void 0===_?null:_,b=e.keys,w=void 0===b?[]:b,x=e.shouldSort,k=void 0===x||x,S=e.getFn,T=void 0===S?U:S,$=e.sortFn,P=void 0===$?function(t,e){return t.score-e.score}:$,C=e.tokenize,I=void 0!==C&&C,L=e.matchAllTokens,A=void 0!==L&&L,E=e.includeMatches,M=void 0!==E&&E,j=e.includeScore,O=void 0!==j&&j,F=e.verbose,N=void 0!==F&&F;(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,B),this.options={location:n,distance:s,threshold:o,maxPatternLength:l,isCaseSensitive:h,tokenSeparator:p,findAllMatches:v,minMatchCharLength:m,id:y,keys:w,includeMatches:M,includeScore:O,shouldSort:k,getFn:T,sortFn:P,verbose:N,tokenize:I,matchAllTokens:A},this.set(t)}return n(B,[{key:"set",value:function(t){return this.list=t}},{key:"search",value:function(t){this._log('---------\nSearch pattern: "'+t+'"');var e=this._prepareSearchers(t),i=e.tokenSearchers,n=e.fullSearcher,r=this._search(i,n),s=r.weights,a=r.results;return this._computeScore(s,a),this.options.shouldSort&&this._sort(a),this._format(a)}},{key:"_prepareSearchers",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",e=[];if(this.options.tokenize)for(var i=t.split(this.options.tokenSeparator),n=0,r=i.length;n<r;n+=1)e.push(new s(i[n],this.options));return{tokenSearchers:e,fullSearcher:new s(t,this.options)}}},{key:"_search",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],e=arguments[1],i=this.list,n={},r=[];if("string"==typeof i[0]){for(var s=0,a=i.length;s<a;s+=1)this._analyze({key:"",value:i[s],record:s,index:s},{resultMap:n,results:r,tokenSearchers:t,fullSearcher:e});return{weights:null,results:r}}for(var o={},c=0,l=i.length;c<l;c+=1)for(var u=i[c],h=0,d=this.options.keys.length;h<d;h+=1){var p=this.options.keys[h];if("string"!=typeof p){if(o[p.name]={weight:1-p.weight||1},p.weight<=0||1<p.weight)throw new Error("Key weight has to be > 0 and <= 1");p=p.name}else o[p]={weight:1};this._analyze({key:p,value:this.options.getFn(u,p),record:u,index:c},{resultMap:n,results:r,tokenSearchers:t,fullSearcher:e})}return{weights:o,results:r}}},{key:"_analyze",value:function(t,e){var i=t.key,n=t.value,r=t.record,s=t.index,a=e.tokenSearchers,o=void 0===a?[]:a,c=e.fullSearcher,l=void 0===c?[]:c,u=e.resultMap,h=void 0===u?{}:u,d=e.results,p=void 0===d?[]:d;if(null!=n){var f=!1,v=-1,g=0;if("string"==typeof n){this._log("\nKey: "+(""===i?"-":i));var m=l.search(n);if(this._log('Full text: "'+n+'", score: '+m.score),this.options.tokenize){for(var _=n.split(this.options.tokenSeparator),y=[],b=0;b<o.length;b+=1){var w=o[b];this._log('\nPattern: "'+w.pattern+'"');for(var x=!1,k=0;k<_.length;k+=1){var S=_[k],T=w.search(S),$={};T.isMatch?($[S]=T.score,x=f=!0,y.push(T.score)):($[S]=1,this.options.matchAllTokens||y.push(1)),this._log('Token: "'+S+'", score: '+$[S])}x&&(g+=1)}v=y[0];for(var P=y.length,C=1;C<P;C+=1)v+=y[C];v/=P,this._log("Token score average:",v)}var I=m.score;-1<v&&(I=(I+v)/2),this._log("Score average:",I);var L=!this.options.tokenize||!this.options.matchAllTokens||g>=o.length;if(this._log("\nCheck Matches: "+L),(f||m.isMatch)&&L){var A=h[s];A?A.output.push({key:i,score:I,matchedIndices:m.matchedIndices}):(h[s]={item:r,output:[{key:i,score:I,matchedIndices:m.matchedIndices}]},p.push(h[s]))}}else if(j(n))for(var E=0,M=n.length;E<M;E+=1)this._analyze({key:i,value:n[E],record:r,index:s},{resultMap:h,results:p,tokenSearchers:o,fullSearcher:l})}}},{key:"_computeScore",value:function(t,e){this._log("\n\nComputing score:\n");for(var i=0,n=e.length;i<n;i+=1){for(var r=e[i].output,s=r.length,a=0,o=1,c=0;c<s;c+=1){var l=r[c].score,u=t?t[r[c].key].weight:1,h=l*u;1!==u?o=Math.min(o,h):a+=r[c].nScore=h}e[i].score=1===o?a/s:o,this._log(e[i])}}},{key:"_sort",value:function(t){this._log("\n\nSorting...."),t.sort(this.options.sortFn)}},{key:"_format",value:function(t){var e=[];this._log("\n\nOutput:\n\n",t);var i=[];this.options.includeMatches&&i.push(function(t,e){var i=t.output;e.matches=[];for(var n=0,r=i.length;n<r;n+=1){var s=i[n],a={indices:s.matchedIndices};s.key&&(a.key=s.key),e.matches.push(a)}}),this.options.includeScore&&i.push(function(t,e){e.score=t.score});for(var n=0,r=t.length;n<r;n+=1){var s=t[n];if(this.options.id&&(s.item=this.options.getFn(s.item,this.options.id)[0]),i.length){for(var a={item:s.item},o=0,c=i.length;o<c;o+=1)i[o](s,a);e.push(a)}else e.push(s.item)}return e}},{key:"_log",value:function(){var t;this.options.verbose&&(t=console).log.apply(t,arguments)}}]),B}();t.exports=r}])}),_.mixin({sortByNat:function(t,e,n){var r=_.isFunction(e)?e:function(t){return t[e]};return _.pluck(_.map(t,function(t,e,i){return{value:t,index:e,criteria:r.call(n,t,e,i)}}).sort(function(t,e){return naturalSort(t.criteria,e.criteria)}),"value")}}),Backbone.Collection.prototype.sortByNat=function(e,t){var i=_.isFunction(e)?e:function(t){return t.get(e)};return _.sortByNat(this.models,i,t)},Backbone.Collection.prototype.sortNat=function(t){if(!this.comparator)throw new Error("Cannot sortNat a set without a comparator");return t||(t={}),_.isString(this.comparator)||1===this.comparator.length?this.models=this.sortByNat(this.comparator,this):this.models.sortNat(_.bind(this.comparator,this)),t.silent||this.trigger("sort",this,t),this},Backbone.Collection.prototype._sort=Backbone.Collection.prototype.sort,Backbone.Collection.prototype.sort=function(){this.sortType&&"natural"===this.sortType?Backbone.Collection.prototype.sortNat.apply(this,arguments):Backbone.Collection.prototype._sort.apply(this,arguments)},Object.defineProperty(HTMLMediaElement.prototype,"playing",{get:function(){return!!(0<this.currentTime&&!this.paused&&!this.ended&&2<this.readyState)}}),jQuery.fn.getInputSelection=function(){var t=this.get(0),e={start:0,end:0,text:""};if(t){if("selectionStart"in t)e.start=t.selectionStart,e.end=t.selectionEnd,e.text=t.value.substring(e.start,e.end);else if(document.selection){t.focus();var i=document.selection.createRange(),n=document.selection.createRange().text.length;i.moveStart("character",-t.value.length),e.start=i.text.length-n,e.end=e.start+n,e.text=i.text}return e}},jQuery.fn.setInputPosition=function(t){var e=this.get(0);if(e)if(e.focus(),"selectionStart"in e)e.setSelectionRange(t,t);else if(e.createTextRange){var i=e.createTextRange();i.move("character",t),i.select()}},function(r){r.fn.getTextSize=function(){var t="text-width-tester",e=this.val(),i=r("#"+t),n={fontWeight:this.css("font-weight"),fontSize:this.css("font-size"),fontFamily:this.css("font-family"),display:"none"};return i.length?i.css(n).html(e):((i=r('<span id="'+t+'">'+e+"</span>")).css(n),r("body").append(i)),{width:i.width(),height:i.height()}}}(jQuery),window.UTIL={},UTIL.escapeInput=function(t){return t.replace(/"/g,"&quot;")},UTIL.formatDate=function(t){var e=new Date(t);return e.getFullYear()+"-"+e.getMonth()+"-"+e.getDate()},UTIL.formatNumber=function(t){return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},UTIL.formatNumberTiny=function(t,e){e||0===e||(e=1);var i=t;return 1e6<t?i=UTIL.round(t/1e6,e)+"M+":1e6==t?i="1M":99999<t?i=UTIL.round(t/1e3)+"K+":1e3<t?i=UTIL.round(t/1e3,e)+"K+":1e3==t&&(i="1K"),i},UTIL.formatTime=function(t,e){var i,n=t||0,r=parseInt(Math.floor(n/3600))%24,s=parseInt(Math.floor(n/60))%60;return"0"==(i=(0<r?r+":":"")+(s<10?"0"+s:s)+":"+((n=UTIL.round(n%60,e))<10?"0"+n:n))[0]&&(i=i.substring(1,i.length)),i},UTIL.formatTimeAlt=function(t){var e=t||0,i=parseInt(Math.floor(e/3600))%24,n=parseInt(Math.floor(e/60))%60;return e=UTIL.round(e%60),0<n?(0<i?i+"h ":"")+n+"m":e+"s"},UTIL.formatTimeMs=function(t,e){return UTIL.formatTime(.001*t,e)},UTIL.getSeconds=function(t,e){for(var i=t.split(":").reverse(),n=0,r=i.length-1;0<=r;r--)switch(r){case 2:n+=60*parseInt(i[r])*60;break;case 1:n+=60*parseInt(i[r]);break;case 0:n+=parseFloat(i[r])}return UTIL.round(n,e)},UTIL.highlightText=function(t,e,i,n){i=i||"<span>",n=n||"</span>";var r=new RegExp("("+t+")","ig");return e.replace(r,i+"$1"+n)},UTIL.makeId=function(t){for(var e="",i="abcdefghijklmnopqrstuvwxyz",n="abcdefghijklmnopqrstuvwxyz0123456789",r=(t=t||8,0);r<t;r++)e+=r<=0?i.charAt(Math.floor(Math.random()*i.length)):n.charAt(Math.floor(Math.random()*n.length));return e},UTIL.randomNumber=function(t){return Math.floor(Math.pow(10,t-1)+9*Math.random()*Math.pow(10,t-1))},UTIL.round=function(t,e){return t=parseFloat(t),e=e||0,Math.round(t*Math.pow(10,e))/Math.pow(10,e)};var COMPONENTS=function(){function t(){this.init()}return t.prototype.init=function(){this.selectInit(),this.alertInit(),this.scrollInit(),this.stickyInit(),this.toggleInit(),this.toggleSoundInit()},t.prototype.alert=function(t,e,i,n){i=i||"#primary-alert",n=n||3e3;var r=$(i);r.html("<div>"+t+"</div>").addClass("active"),this.timeout&&clearTimeout(this.timeout),e&&(this.timeout=setTimeout(function(){r.removeClass("active")},n))},t.prototype.alertInit=function(){var s=this;$(window).on("alert",function(t,e,i,n,r){s.alert(e,i,n,r)}),$(".alert").on("click",function(){$(this).removeClass("active")})},t.prototype.scrollInit=function(){var r=this;$(window).on("scroll-to",function(t,e,i,n){r.scrollTo(e,i,n)})},t.prototype.scrollTo=function(t,e,i){e=e||0,i=i||2e3,$("html, body").animate({scrollTop:t.offset().top-e},2e3)},t.prototype.select=function(t){var e=t.closest(".select"),i=e.find(".select-active"),n=e.find(".select-option"),r=t.attr("data-active")||t.text();n.removeClass("selected").attr("aria-checked","false"),t.addClass("selected").attr("aria-checked","true"),i.text(r),e.removeClass("active")},t.prototype.selectInit=function(){var e=this;$(document).on("click",".select-active",function(){e.selectMenu($(this).closest(".select"))}),$(document).on("click",".select-option",function(){e.select($(this))}),$(document).on("click",function(t){$(t.target).closest(".select").length||e.selectMenusHide()})},t.prototype.selectMenu=function(t){t.addClass("active")},t.prototype.selectMenusHide=function(){$(".select").removeClass("active")},t.prototype.sticky=function(t){var e=$(".sticky-on-scroll");if(!e.length)return!1;var i=t?$(t).height():0,n=$(window).scrollTop();e.each(function(){var t=$(this);t.offset().top-i<n?$(t.attr("data-sticky")).addClass("sticky"):$(t.attr("data-sticky")).removeClass("sticky")})},t.prototype.stickyInit=function(){var i=this;$(window).on("sticky-on",function(t,e){i.stickyOn(e)})},t.prototype.stickyOn=function(t){if(this.sticky_is_on)return!1;this.sticky_is_on=!0;var e=this;$(window).on("scroll",function(){e.sticky(t)})},t.prototype.toggle=function(t){$(t).toggleClass("active")},t.prototype.toggleInit=function(){var e=this;$(document).on("click",".toggle-active",function(t){t.preventDefault(),e.toggle($(this).attr("data-target"))})},t.prototype.toggleSound=function(t){var e=t[0];e&&e.muted?e.muted=!1:e&&(e.muted=!0)},t.prototype.toggleSoundInit=function(){var e=this;$(document).on("click",".toggle-sound",function(t){t.preventDefault(),e.toggleSound($(this))})},t}();$(function(){new COMPONENTS}),window.ANALYTICS={},ANALYTICS.event=function(t,e,i,n){ga&&(i&&n?ga("send","event",t,e,i,n):i?ga("send","event",t,e,i):ga("send","event",t,e))},window.API_URL=PROJECT.apiUrl||window.location.protocol+"//"+window.location.hostname,window.location.port&&!PROJECT.apiUrl&&(window.API_URL+=":"+window.location.port),window.DEBUG=!0,window.app={models:{},collections:{},views:{},routers:{},initialize:function(){_.object(_.map(PROJECT.authProviders,function(t){return[t.name,t.path]}));PubSub.subscribe("auth.oAuthSignIn.success",function(t,e){window.location.reload(!0)}),PubSub.subscribe("auth.signOut.success",function(t,e){window.location.reload(!0)});new app.routers.DefaultRouter;var t=!(!window.history||!window.history.pushState);Backbone.history=Backbone.history||new Backbone.History({}),Backbone.history.start({pushState:t})}},window.app.pageTitle=function(t){t||(t="");var e=document.getElementsByTagName("title");if(!e.length)return"";var i=e[0],n=i.getAttribute("data-title-sitename")?i.getAttribute("data-title-sitename"):i.textContent,r=i.getAttribute("data-title-template")?i.getAttribute("data-title-template"):"";return t.length&&r.length?r.replace("{{sitename}}",n).replace("{{pagename}}",t):i.textContent},$(function(){app.initialize()}),window.app.socialIntegration=function(){this.intervalStage1=null,this.intervalStage2=null,this.initialised=!1,this.attempts=0,this.maxAttempts=100,this.shown=!1;this.showSocialWidgets=function(){window.twttr.widgets.load(),FB.XFBML.parse(),this.shown=!0},this.runIntervalStage2=function(){var t;if(!this.shown)return(t=window).twttr&&t.twttr.widgets&&t.twttr.widgets.load&&t.FB&&t.FB.XFBML&&t.FB.XFBML.parse?(clearInterval(this.socialLoadIntId),void this.showSocialWidgets()):(this.attempts++,this.attempts>=this.maxAttempts?(console.error("Gave up on loading social widgets."),void clearInterval(this.socialLoadIntId)):void 0)},this.initFacebook=function(t,e,i,n){if(!document.getElementById("fb-root"))return!1;var r,s=t.getElementsByTagName(e)[0];return t.getElementById(i)?void 0:((r=t.createElement(e)).id=i,r.src="//connect.facebook.net/en_GB/sdk.js#xfbml=1&version=v2.8&appId="+n,s.parentNode.insertBefore(r,s),!0)},this.initTwitter=function(t,e,i){var n,r=t.getElementsByTagName(e)[0],s=window.twttr||{};return t.getElementById(i)||((n=t.createElement(e)).id=i,n.src="https://platform.twitter.com/widgets.js",r.parentNode.insertBefore(n,r),s._e=[],s.ready=function(t){s._e.push(t)}),s},this.initSocialScripts=function(){if(!document.getElementById("fb-root")){var t=document.getElementsByTagName("body")[0],e=document.createElement("div");e.setAttribute("id","fb-root"),t.insertBefore(e,t.firstChild)}window.fbLoad=this.initFacebook(document,"script","facebook-jssdk",facebookAppId),window.twttr=this.initTwitter(document,"script","twitter-wjs"),this.initialised=!!document.getElementById("fb-root")&&!!window.fbLoad&&!!window.twttr},this.completeStage1=function(){this.attempts=0,this.shown=!1,this.intervalStage2&&clearInterval(this.intervalStage2),this.intervalStage2=setInterval(this.runIntervalStage2.bind(this),250)},this.runIntervalStage1=function(){this.initialised?(clearInterval(this.intervalStage1),this.completeStage1()):this.initSocialScripts()},this.init=function(){this.intervalStage1&&clearInterval(this.intervalStage1),this.intervalStage1=setInterval(this.runIntervalStage1.bind(this),250)}},window.app.social=new window.app.socialIntegration,document.addEventListener("DOMContentLoaded",function(t){window.app.social.init()}),app.routers.DefaultRouter=Backbone.Router.extend({routes:{"":"index","?*queryString":"index","transcripts/:id":"transcriptEdit","transcripts/:id?*queryString":"transcriptEdit","page/:id":"pageShow",dashboard:"dashboard",search:"search","search?*queryString":"search",collections:"collections"},before:function(t,e){$("#main").empty().addClass("loading")},after:function(t,e){window.scrollTo(0,0)},dashboard:function(){var t=this._getData(t),e=(new app.views.Header(t),new app.views.Dashboard(t));new app.views.Footer(t);e.$el.attr("role","main")},index:function(t){var e=this._getData(e);t&&(e.queryParams=deparam(t));new app.views.Header(e),new app.views.Home(e),new app.views.Footer(e)},pageShow:function(t){var e=this._getData(e),i=(new app.views.Header(e),new app.views.Page(_.extend({},e,{el:"#main",page_key:t})));new app.views.Footer(e);i.$el.removeClass("loading").attr("role","main")},search:function(t){var e=this._getData(e);t&&(e.queryParams=deparam(t));new app.views.Header(e),new app.views.Search(e),new app.views.Footer(e)},collections:function(){var t=this._getData(t);new app.views.Header(t),new app.views.Collections(t),new app.views.Footer(t)},transcriptEdit:function(t,e){var i=this._getData(i);e&&(i.queryParams=deparam(e));new app.views.Header(i),new app.views.TranscriptToolbar(_.extend({},i,{el:"#secondary-navigation",menu:"transcript_edit"}));var n=new app.views.Modals(i),r=(new app.views.Footer(i),new app.views.TranscriptLineVerify(i));n.addModal(r.$el);var s=new app.views.TranscriptLineFlag(i);n.addModal(s.$el);var a=new app.views.TranscriptDownload(_.extend({},i,{transcript_id:t}));n.addModal(a.$el);var o=new app.models.Transcript({id:t});new app.views.TranscriptEdit(_.extend({},i,{el:"#main",model:o}))},_getData:function(t){var e={};return $.auth.user&&$.auth.user.signedIn&&(e=$.auth.user),t=t||{},t=$.extend({},{project:PROJECT,user:e,debug:DEBUG,route:this._getRouteData()},t),DEBUG&&console.log("Route",t.route),t},_getRouteData:function(){var t,e=this,i=Backbone.history.fragment,n=_.pairs(e.routes),r=null,s=null,a=null;return(t=_.find(n,function(t){return(s=_.isRegExp(t[0])?t[0]:e._routeToRegExp(t[0])).test(i)}))&&(a=e._extractParameters(s,i),r=t[0],s=t[1]),{route:r,action:s,fragment:i,path:i?"/#/"+i:"/",params:a}}}),app.models.Transcript=Backbone.Model.extend({parse:function(t){return t},url:function(){var t=this.get("uid")||this.id;return API_URL+"/transcripts/"+t+".json"}}),app.collections.Collections=Backbone.Collection.extend({url:function(){return API_URL+"/collections.json"}}),app.collections.Transcripts=Backbone.Collection.extend({sortType:"natural",initialize:function(t){this.options=_.extend({},{endpoint:"/transcripts.json"},t),this.params={page:1},this.options.params&&(this.params=_.extend({},this.params,this.options.params))},getPage:function(){return this.params.page},getParam:function(t){return this.params[t]},getParams:function(){return this.params},hasAllPages:function(){return!this.hasMorePages()},hasMorePages:function(){return this.params.page*this.per_page<this.total},nextPage:function(){this.params.page+=1},parse:function(t){this.params.page=t.current_page,this.per_page=t.per_page,this.total=t.total_entries;var i=[];return _.each(t.entries,function(t,e){t.completeness=t.percent_completed+.01*t.percent_edited,i.push(t)}),i},setParams:function(t){var i=this;_.each(t,function(t,e){"ALL"!=t&&t.length?i.params[e]=t:i.params=_.omit(i.params,e)})},url:function(){var t="?"+$.param(this.params);return API_URL+this.options.endpoint+t}}),app.views.Base=Backbone.View.extend({}),app.views.Collections=app.views.Base.extend({el:"#main",template:_.template(TEMPLATES["collections_index.ejs"]),initialize:function(t){this.data=_.extend({},{queryParams:{}},t),this.render()},onCollectionsLoaded:function(t){var e=t.toJSON();this.$el.html(this.template({collections:e})),this.$el.removeClass("loading")},render:function(){return document.title=app.pageTitle("Collections"),this.collections=this.collections||new app.collections.Collections({endpoint:"/collections.json"}),this.collections.fetch({success:this.onCollectionsLoaded.bind(this),error:function(t,e,i){$(window).trigger("alert",["Whoops! We seem to have trouble loading our transcripts. Please try again by refreshing your browser or come back later!"])}}),this}}),app.views.Account=app.views.Base.extend({el:"#account-container",template:_.template(TEMPLATES["account.ejs"]),events:{"click .auth-link":"doAuthFromLink","click .check-auth-link":"checkAuthForLink","click .sign-out-link":"signOut"},initialize:function(t){this.data=t,this.data.signedIn=!1,this.data.score=0,this.loadListeners(),this.loadUser(),this.render()},loadUser:function(){var e=this;console.log("Logged in user"),$.post(API_URL+"/authenticate.json",function(t){user=t.user,user.id?(e.data.signedIn=!0,e.data.user=user,e.data.score=user.lines_edited,PubSub.publish("auth.validation.success",user)):(e.data.signedIn=!1,e.data.user=null,e.data.score=null)})},doAuth:function(t){$.auth.oAuthSignIn({provider:t}).fail(function(t){$(window).trigger("alert",["Authentication failure: "+t.errors.join(" ")])})},doAuthFromLink:function(t){t.preventDefault();var e=$(t.currentTarget).attr("data-provider");this.doAuth(e)},checkAuthForLink:function(e){e.preventDefault(),$.auth.validateToken().then(function(t){console.log("checkAuthForLink success"),window.location.href=e.target.href}).fail(function(){console.log("checkAuthForLink failure"),$(window).trigger("alert",["You must log in as admin to access this section.",!0])})},listenForAuth:function(){var i=this;PubSub.subscribe("auth.oAuthSignIn.success",function(t,e){i.onValidationSuccess($.auth.user),$(window).trigger("alert",["Successfully signed in as "+$.auth.user.name+"!  Refreshing page...",!0])}),PubSub.subscribe("auth.validation.success",function(t,e){i.onValidationSuccess(e)}),PubSub.subscribe("auth.signOut.success",function(t,e){i.onSignOutSuccess(),$(window).trigger("alert",["Successfully signed out! Refreshing page...",!0])})},loadListeners:function(){var i=this;this.listenForAuth(),PubSub.subscribe("transcript.edit.submit",function(t,e){e.is_new&&i.data.user.signedIn&&(i.data.score+=1,i.updateScore())})},onSignOutSuccess:function(){this.data.user={},this.data.score=0,window.history.pushState({},document.title,"/")},onValidationSuccess:function(t){this.data.user=t,this.data.score=t.lines_edited,this.render()},render:function(){return this.$el.html(this.template(this.data)),this},signOut:function(t){t&&t.preventDefault(),$.auth.signOut()},updateScore:function(){this.$(".score").text(UTIL.formatNumberTiny(this.data.score)).addClass("active")}}),app.views.Crumbs=app.views.Base.extend({template:_.template(TEMPLATES["crumbs.ejs"]),initialize:function(t){this.data=t,this.data.crumbs=this.data.crumbs||[],this.listenForCrumbs(),this.render()},listenForCrumbs:function(){var n=this;PubSub.subscribe("transcript.load",function(t,e){var i={label:e.label||e.transcript.title};n.data.crumbs=[i],n.render()})},render:function(){return this.$el.html(this.template(this.data)),this}}),app.views.Menu=app.views.Base.extend({template:_.template(TEMPLATES["menu.ejs"]),initialize:function(t){this.data=t,this.data.menu_key=this.data.menu_key||"";var e=this.data.project.menus||{},i=this.data.menu_key;this.data.menu=[],i&&e[i]&&(this.data.menu=e[i]),this.render()},render:function(){return this.$el.html(this.toString()),this},toString:function(){return this.template(this.data)}}),app.views.Modal=app.views.Base.extend({tagName:"div",className:"modal-wrapper",template:_.template(TEMPLATES["modal.ejs"]),events:{"click .modal-tab":"tab"},initialize:function(t){this.data=_.extend({},t),this.data.active_page=0,this.data.active=!1,this.loadContents(),this.render()},loadContents:function(){var n=this,r=this.data.page?[this.data.page]:this.data.pages;_.each(r,function(t,e){var i=new app.views.Page(_.extend({},n.data,{page_key:t.file}));r[e].contents=i.toString()}),this.data.pages=r},render:function(){return this.$el.html(this.template(this.data)),this},tab:function(t){t&&t.preventDefault();var e=$(t.currentTarget);this.data.active_page=parseInt(e.attr("data-tab")),this.data.active=!0,this.render()}}),app.views.Page=app.views.Base.extend({template:_.template(TEMPLATES["page.ejs"]),initialize:function(t){this.data=_.extend({},t),this.data.content=this.data.content||"",this.getPageContent(),this.el&&this.render(),this.displayQueryStringAlert()},getPageContent:function(){var t=this.data.page_key,e=this.data.project.pages;if(!t)return!1;if(e[t]||(t+=".md"),e[t]){var i=_.template(e[t]);this.data.content=i(this.data)}},getPageTitle:function(){if(this.data.page_key){var t=this.data.content.match(/<h1.*>([^<]+)<\/h1>/);if(t)return t[1]}return""},render:function(){this.$el.html(this.toString());var t=this.getPageTitle();return t.length&&(document.title=app.pageTitle(t)),this},toString:function(){return this.template(this.data)},displayQueryStringAlert:function(){if(window.location.search&&window.location.search.length){var t=window.location.search.match(/show_alert=([^&]+)/);if(t){$(window).trigger("alert",[decodeURIComponent(t[1]).replace(/\+/g," "),!0]);var e=window.location.href.replace("show_alert="+t[1]).replace(/(&+)/,"&").replace(/(\?&)/,"?");window.history.pushState({},document.title,e)}}}}),app.views.Dashboard=app.views.Base.extend({template:_.template(TEMPLATES["user_dashboard.ejs"]),el:"#main",initialize:function(t){this.data=t,this.secondsPerLine=5,this.listenForAuth()},listenForAuth:function(){var i=this;PubSub.subscribe("auth.validation.success",function(t,e){i.loadData(e)})},loadData:function(t){var e=this;this.data.transcripts=[],$.getJSON("/transcript_edits.json",{user_id:t.id},function(t){t.edits&&t.edits.length&&e.parseEdits(t.edits,t.transcripts),e.render()})},parseEdits:function(r,t){var s=this;r=_.map(r,function(t){var e=_.clone(t);return e.updated_at=Date.parse(e.updated_at)/1e3,e});t=_.map(t,function(e,t){var i=_.clone(e);i.index=t,i.edits=_.filter(r,function(t){return t.transcript_id==e.id}),i.edit_count=i.edits.length,i.seconds_edited=i.edit_count*s.secondsPerLine;var n=_.max(i.edits,function(t){return t.updated_at});return n&&(i.updated_at=n.updated_at),i});this.data.transcripts=_.sortBy(t,function(t){return t.updated_at}).reverse(),this.data.edit_count=r.length,this.data.seconds_edited=this.data.edit_count*this.secondsPerLine},render:function(){return this.$el.html(this.template(this.data)),this.$el.removeClass("loading"),this}}),app.views.Footer=app.views.Base.extend({el:"#footer",initialize:function(t){this.data=_.extend({},t),this.render()},render:function(){return this.renderContent(),this.renderMenu(),this},renderContent:function(){if(this.data.project.pages["footer.md"]){var t=new app.views.Page(_.extend({},this.data,{page_key:"footer.md"}));this.$el.append(t.render().$el)}},renderMenu:function(){new app.views.Menu(_.extend({},this.data,{el:"#footer-menu-container",menu_key:"footer"}))}}),app.views.Header=app.views.Base.extend({el:"#header",title_template:_.template(TEMPLATES["header_title.ejs"]),initialize:function(t){this.data=t,this.render()},render:function(){this.renderTitle();new app.views.Crumbs(_.extend({},this.data,{el:"#header-crumbs"})),new app.views.Menu(_.extend({},this.data,{el:"#primary-menu-container",menu_key:"header"})),new app.views.Account(this.data);return this},renderTitle:function(){this.$el.find("#header-title").html(this.title_template(this.data))}}),app.views.Home=app.views.Base.extend({el:"#main",initialize:function(t){this.data=t,this.render()},render:function(){var t=new app.views.Page(_.extend({},this.data,{page_key:"home.md"})),e=new app.collections.Transcripts,i=new app.collections.Collections,n=new app.views.TranscriptsIndex(_.extend({},this.data,{collection:e,collections:i}));return this.$el.append(t.render().$el),this.$el.append(n.$el),this.$el.removeClass("loading"),this}}),app.views.Modals=app.views.Base.extend({el:"#app",events:{"click .modal-dismiss":"dismissModals","click .modal-invoke":"invokeModalFromLink"},initialize:function(t){this.data=t,this.lastInvoked=!1,this.loadListeners(),this.render()},addModal:function(t){this.$el.append(t)},dismissModals:function(t){t&&t.preventDefault(),this.$(".modal").removeClass("active")},invokeModal:function(t){this.$("#"+t).find(".modal").addClass("active"),this.lastInvoked=t},invokeModalFromLink:function(t){t.preventDefault(),this.invokeModal($(t.currentTarget).attr("data-modal"))},loadListeners:function(){var i=this;PubSub.subscribe("modal.invoke",function(t,e){i.invokeModal(e)}),PubSub.subscribe("modals.dismiss",function(t,e){i.dismissModals()}),PubSub.subscribe("player.state.change",function(t,e){i.$el.attr("state",e)})},render:function(){if(this.$(".modal").length)return this;var n=this;this.data.project.pages;return _.each(this.data.project.modals,function(t,e){var i=_.extend({},t,{id:e,project:n.data.project});t=new app.views.Modal(i);n.$el.append(t.$el)}),this}}),app.views.Search=app.views.Base.extend({el:"#main",template:_.template(TEMPLATES["transcript_search.ejs"]),template_list:_.template(TEMPLATES["transcript_list.ejs"]),template_item:_.template(TEMPLATES["transcript_search_item.ejs"]),events:{"submit .search-form":"searchFromForm","keyup .search-form input":"searchFromInput"},initialize:function(t){this.data=_.extend({},{queryParams:{}},t),this.render(),this.loadListeners(),this.loadTranscripts(),this.loadCollections()},loadCollections:function(){var n=this;this.collections=this.collections||new app.collections.Collections,this.collections.fetch({success:function(t,e,i){n.renderFacets(t.toJSON())},error:function(t,e,i){n.renderFacets([])}})},loadListeners:function(){var n=this;PubSub.subscribe("transcripts.filter",function(t,e){var i={};i[e.name]=e.value,n.setParams(i)}),PubSub.subscribe("transcripts.sort",function(t,e){n.setParams({sort_by:e.name,order:e.order})}),PubSub.subscribe("transcripts.search",function(t,e){n.setParams({q:e})})},loadTranscripts:function(){var n=this,t=this.data.queryParams;t.deep=1,this.$transcripts.addClass("loading"),this.transcripts=this.transcripts||new app.collections.Transcripts({endpoint:"/search.json",params:t}),this.transcripts.fetch({success:function(t,e,i){n.renderTranscripts(t)},error:function(t,e,i){$(window).trigger("alert",["Whoops! We seem to have trouble loading our transcripts. Please try again by refreshing your browser or come back later!"])}})},render:function(){return this.$el.html(this.template(this.data)),this.$el.removeClass("loading"),this.$transcripts=this.$("#transcript-results"),this.$facets=this.$("#transcript-facets"),document.title=app.pageTitle("Search"),this},renderFacets:function(t){this.facetsView=this.facetsView||new app.views.TranscriptFacets({collections:t,queryParams:this.data.queryParams,disableSearch:!0,disableSort:!0}),this.$facets.html(this.facetsView.render().$el)},renderTranscripts:function(t){var i=this,e=t.toJSON(),n=this.template_list({has_more:t.hasMorePages()}),r=$(n),s=r.first(),a=t.getParam("q")||"";1<t.getPage()?this.$transcripts.append(r):(this.$transcripts.empty(),e.length?this.$transcripts.html(r):this.$transcripts.html("<p>No transcripts found!</p>")),this.$transcripts.removeClass("loading"),_.each(e,function(t){var e=i.template_item(_.extend({},t,{query:a}));s.append($(e))}),$(window).trigger("scroll-to",[this.$("#search-form"),110])},search:function(t){PubSub.publish("transcripts.search",t)},searchFromForm:function(t){t.preventDefault();var e=$(t.currentTarget).find('input[name="keyword"]').val();e=e.trim().toLowerCase(),this.search(e)},searchFromInput:function(t){var e=$(t.currentTarget).val();(e=e.trim()).length||this.search(e)},setParams:function(t){this.$transcripts.empty().addClass("loading"),t.page=1,this.transcripts.setParams(t),this.loadTranscripts(),this.updateUrlParams()},updateUrlParams:function(){var t=this.transcripts.getParams();if(0<_.keys(t).length&&window.history){var e="/"+this.data.route.route+"?"+$.param(t);window.history.pushState(t,document.title,e)}else if(window.history){e="/"+this.data.route.route;window.history.pushState(t,document.title,e)}}}),app.views.Transcript=app.views.Base.extend({current_line_i:-1,play_all:!1,centerOn:function(t){var e,i=t.offset().top,n=t.height(),r=$(window).height(),s=9999,a=+new Date;this.lastCenterActionTime&&(s=a-this.lastCenterActionTime),this.lastCenterActionTime=a,e=n<r?i-(r/2-n/2):i,s<600?$("html, body").scrollTop(e):$("html, body").animate({scrollTop:e},500)},checkForStartTime:function(){if(!this.data.queryParams||!this.data.queryParams.t)return!1;var i=UTIL.getSeconds(this.data.queryParams.t);if(!i)return!1;var n=0;_.each(this.data.transcript.lines,function(t,e){UTIL.getSeconds(UTIL.formatTime(t.start_time/1e3))<=i&&(n=e)}),this.lineSelect(n)},fitInput:function(t){var e=parseInt(t.css("font-size")),i=t.width()+5;t.attr("original-font-size")||t.attr("original-font-size",e);var n=t.getTextSize().width;i<n&&(e=e*i/n*.8),t.css({fontSize:e+"px"})},fitInputReset:function(t){t.attr("original-font-size")&&t.css({fontSize:t.attr("original-font-size")+"px"})},getPageTitle:function(){return this.data.transcript?this.data.transcript.title:""},lineNext:function(){this.lineSelect(this.current_line_i+1)},linePrevious:function(){this.lineSelect(this.current_line_i-1)},lineSave:function(t){},lineSelect:function(t){if(t>=this.data.transcript.lines.length)return this.onLineOff(this.current_line_i),PubSub.publish("transcript.finished",!0),!1;if(t<0||t==this.current_line_i)return!1;this.onLineOff(this.current_line_i),this.current_line_i=t,this.current_line=this.data.transcript.lines[t];var e=$('.line[sequence="'+t+'"]').first(),i=e.find("input");$(".line.active").removeClass("active"),e.addClass("active"),this.centerOn(e),this.play_all||i.length&&i.first().focus(),this.fitInput(i),this.pause_at_time=.001*this.current_line.end_time,this.playerPlay(this.current_line.start_time)},lineSubmit:function(){this.lineNext()},lineToggle:function(){this.current_line_i<0?this.lineSelect(0):void 0!==this.pause_at_time&&this.player.currentTime>=this.pause_at_time&&!this.player.playing?this.playerPlay(this.current_line.start_time):this.playerToggle()},listenForAuth:function(){var i=this;PubSub.subscribe("auth.oAuthSignIn.success",function(t,e){i.refresh()}),PubSub.subscribe("auth.signOut.success",function(t,e){i.refresh()})},loadAudio:function(){if(this.player){if($(this.player).attr("data-transcript")==""+this.data.transcript.id)return this.onAudioLoad(),!1;$(this.player).remove()}var t=this,e=this.data.project.useVendorAudio&&this.data.transcript.vendor_audio_urls.length?this.data.transcript.vendor_audio_urls:[this.data.transcript.audio_url],n='<audio data-transcript="'+this.data.transcript.id+'" preload>';_.each(e,function(t){var e=t.substr(t.lastIndexOf(".")+1),i=e;"mp3"==e&&(i="mpeg"),n+='<source src="'+t+'" type="audio/'+i+'">'}),n+="</audio>";var i=$(n);this.player=i[0],this.player.onloadstart=function(){t.player_loaded||(t.player_loaded=!0,t.onAudioLoad())},this.player.ontimeupdate=function(){t.onTimeUpdate()},this.player.onwaiting=function(){t.message("Buffering audio..."),t.playerState("buffering")}},loadListeners:function(){},loadTranscript:function(){var n=this;this.$el.addClass("loading"),this.model.fetch({success:function(t,e,i){n.onTranscriptLoad(t)},error:function(t,e,i){$(window).trigger("alert",["Whoops! We seem to have trouble loading this transcript. Please try again by refreshing your browser or come back later!"])}})},loadUserProgress:function(){},message:function(t){},messageHide:function(t){},onAudioLoad:function(){},onLineOff:function(t){PubSub.publish("modals.dismiss",!0),this.lineSave(t);var e=$('.line[sequence="'+t+'"] input').first();this.fitInputReset(e)},onTranscriptLoad:function(t){},onTimeUpdate:function(){},parseTranscript:function(){var d=this,t=this.data.transcript.lines,e=this.data.transcript.user_edits,p=this.data.transcript.transcript_line_statuses,f=this.data.transcript.speakers||[],v=PROJECT.consensus.superUserHiearchy,g=this.data.transcript.user_role,i=this.data.transcript.user_flags,m=PROJECT.maxLineTimeOverlapMs,n=PROJECT.allowTranscriptDownload,y=_.object(_.map(e,function(t){return[""+t.transcript_line_id,t.text]})),b=_.object(_.map(p,function(t){return[""+t.id,t]})),r=_.map(f,_.clone);1<f.length&&r.push({id:-1,name:"Multiple Speakers"}),this.data.transcript.speaker_options=r;var w=_.object(_.map(r,function(t){return[""+t.id,t]})),x=_.pluck(r,"id"),k=_.object(_.map(i,function(t){return[""+t.transcript_line_id,t]}));this.data.transcript.can_download=n&&this.data.transcript.can_download,_.each(t,function(t,e){var i="";_.has(y,""+t.id)&&(i=y[""+t.id]),d.data.transcript.lines[e].user_text=i;var n=p[0];_.has(b,""+t.transcript_line_status_id)&&(n=b[""+t.transcript_line_status_id]),d.data.transcript.lines[e].status=n;var r=t.original_text;t.text&&"completed"==n.name?r=t.text:i?r=i:"guess"==PROJECT.consensus.lineDisplayMethod&&t.guess_text&&(r=t.guess_text),d.data.transcript.lines[e].display_text=r;var s=!0;_.contains(["reviewing","completed","flagged","archived"],n.name)&&(s=!1),"reviewing"==n.name&&i&&(s=!0),g&&g.hiearchy>=v&&(s=!0),d.data.transcript.lines[e].is_editable=s;var a=!0;_.contains(["completed","archived"],n.name)&&(a=!1),d.data.transcript.lines[e].is_available=a;var o=!1,c=-1;_.has(w,""+t.speaker_id)&&(o=w[""+t.speaker_id],c=x.indexOf(o.id)),d.data.transcript.lines[e].speaker=o,d.data.transcript.lines[e].speaker_pos=c,d.data.transcript.lines[e].has_speakers=1<f.length;var l={flag_type_id:0,text:""};_.has(k,""+t.id)&&(l=k[""+t.id]),d.data.transcript.lines[e].user_flag=l;var u=!1;if(g&&g.hiearchy>=v&&(u=!0),d.data.transcript.lines[e].can_resolve=u,0<=m&&0<e){var h=d.data.transcript.lines[e-1].end_time-t.start_time;if(m<h){d.data.transcript.lines[e-1].end_time=d.data.transcript.lines[e].start_time+0,d.data.transcript.lines[e].start_time=d.data.transcript.lines[e].start_time-0}}}),0<this.data.transcript.percent_reviewing&&(this.data.transcript.hasLinesInReview=!0),0<this.data.transcript.percent_completed&&(this.data.transcript.hasLinesCompleted=!0)},playerPause:function(t){void 0===t&&(t={}),this.player.playing&&(this.player.pause(),this.message("Paused"),this.playerState("paused"),this.play_all&&"end_of_line"==t.trigger&&this.lineNext())},playerPlay:function(t){void 0!==t&&(this.player.currentTime=.001*t),this.player.playing||this.player.play()},playerState:function(t){if(this.state==t)return!1;this.state=t,this.$el.attr("state",t),PubSub.publish("player.state.change",t)},playerToggle:function(){this.player.playing?this.playerPause({trigger:"manual"}):this.playerPlay()},refresh:function(){this.current_line_i=-1,this.loadTranscript()},render:function(){this.$el.html(this.template(this.data)),this.renderLines(),this.loadUserProgress();var t=this.getPageTitle();t.length&&(document.title=app.pageTitle(t))},renderLines:function(){var t=this.$el.find("#transcript-lines"),i=$("<div>");if(!t.length)return!1;t.empty();var n=this.data.transcript.speaker_options,r=this.data.transcript.id,s=this.data.transcript.flag_types;_.each(this.data.transcript.lines,function(t){var e=new app.views.TranscriptLine({transcript_id:r,line:t,speakers:n,flag_types:s});i.append(e.$el)}),t.append(i)},start:function(){this.$(".start-play, .play-all").addClass("disabled");var i=0,t=this.data.transcript.lines;$.each(t,function(t,e){if(e.is_editable)return i=t,!1}),this.lineSelect(i)},playAll:function(){this.play_all=!0,this.start()},submitEdit:function(t){var e=this;this.message("Saving changes..."),$.post(API_URL+"/transcript_edits.json",{transcript_edit:t},function(t){e.message("Changes saved.")}),PubSub.publish("transcript.edit.submit",t)}}),app.views.TranscriptDownload=app.views.Base.extend({id:"transcript-download",className:"modal-wrapper",template:_.template(TEMPLATES["transcript_download.ejs"]),events:{"click .download":"download","submit .download-form":"download","change .formatOption":"selectFormat","change .format-options input":"updateURL"},initialize:function(t){var i=this;this.data=_.extend({},t),this.data.active=!1,this.data.transcript=!1,this.base_url=API_URL+"/transcript_files/"+this.data.transcript_id,PubSub.subscribe("transcript.load",function(t,e){i.onTranscriptLoad(e.transcript)})},download:function(t){t&&t.preventDefault();var e=this.$("#transcript-download-url").val();window.open(e)},onTranscriptLoad:function(t){this.data.transcript=t,this.render(),this.updateURL()},render:function(){this.$el.html(this.template(this.data))},selectFormat:function(t){var e=$(t.currentTarget).val();this.$(".format-options").removeClass("active"),this.$('.format-options[data-format="'+e+'"]').addClass("active"),this.updateURL()},updateURL:function(t){var e=this.$('input:radio[name="format"]:checked').val(),i=this.$(".format-options.active input").serialize(),n=this.base_url+"."+e;i.length&&(n+="?"+i),this.$("#transcript-download-url").val(n)}}),app.views.TranscriptFacets=app.views.Base.extend({template:_.template(TEMPLATES["transcript_facets.ejs"]),events:{"click .filter-by":"filterFromEl","click .sort-by":"sortFromEl","submit .search-form":"searchFromForm","keyup .search-form input":"searchFromInput"},initialize:function(t){this.data=_.extend({disableSearch:!1,disableSort:!1},t),this.initFacets(),$(window).trigger("sticky-on",["#header"])},filter:function(t,e){PubSub.publish("transcripts.filter",{name:t,value:e})},filterFromEl:function(t){var e=$(t.currentTarget);this.filter(e.attr("data-filter"),e.attr("data-value"))},initFacets:function(){var e=Amplify.getConfig("homepage.search.sort_options.active_collection_id","ALL"),i=Amplify.getConfig("homepage.search.sort_options.active_sort","id"),n=Amplify.getConfig("homepage.search.sort_options.active_order","asc"),t=Amplify.getConfig("homepage.search.sort_options.active_keyword","");if(this.data.queryParams){var r=this.data.queryParams;r.sort_by&&(i=r.sort_by),r.order&&(n=r.order),r.collection_id&&(e=r.collection_id),r.keyword&&(t=r.keyword)}if(this.data.collections.length){this.data.collections.unshift({id:"ALL",title:"All Collections"}),this.data.collections=_.map(this.data.collections,function(t){return t.active=!1,t.id==e&&(t.active=!0),t}),this.data.active_collection=_.findWhere(this.data.collections,{active:!0})}this.data.sort_options=[{id:"random_asc",name:"random",order:"asc",label:"Random"},{id:"title_asc",name:"title",order:"asc",label:"Title (A to Z)"},{id:"title_desc",name:"title",order:"desc",label:"Title (Z to A)"},{id:"completeness_desc",name:"completeness",order:"desc",label:"Completeness (most to least)"},{id:"completeness_asc",name:"completeness",order:"asc",label:"Completeness (least to most)"},{id:"duration_asc",name:"duration",order:"asc",label:"Duration (short to long)"},{id:"duration_desc",name:"duration",order:"desc",label:"Duration (long to short)"},{id:"collection_asc",name:"collection_id",order:"asc",label:"Collection"}],this.data.sort_options=_.map(this.data.sort_options,function(t){return t.active=!1,t.name==i&&t.order==n&&(t.active=!0),t}),this.data.active_sort=_.findWhere(this.data.sort_options,{active:!0}),this.data.active_keyword=t},render:function(){return this.$el.html(this.template(this.sanitiseRenderData(this.data))),this},sanitiseRenderData:function(t){return t.collections=t.collections.map(function(t){return t.hasOwnProperty("description")&&(t.description=t.description.replace(/<[^>]+>/g,"")),t}),t},search:function(t){PubSub.publish("transcripts.search",t)},searchFromForm:function(t){t.preventDefault();var e=$(t.currentTarget).find('input[name="keyword"]').val();e=e.trim().toLowerCase(),this.search(e)},searchFromInput:function(t){var e=$(t.currentTarget).val();(e=e.trim()).length||this.search(e)},sortTranscripts:function(t,e){PubSub.publish("transcripts.sort",{name:t,order:e})},sortFromEl:function(t){var e=$(t.currentTarget);this.sortTranscripts(e.attr("data-sort"),e.attr("data-order"))}}),app.views.TranscriptLineFlag=app.views.Base.extend({id:"transcript-line-flag",className:"modal-wrapper",template:_.template(TEMPLATES["transcript_line_flag.ejs"]),events:{"click .option":"select","click .submit":"submit","click .toggle-play":"togglePlay","click .view-flags":"viewFlags","click .view-add-flag":"viewForm"},initialize:function(t){var i=this;this.lines={},this.data=_.extend({},t),this.data.title=this.data.title||"Flag this transcript line",this.data.active=this.data.active||!1,PubSub.subscribe("transcript.flags.load",function(t,e){i.onLoad(e)})},onLoad:function(t){if(!this.lines[t.line.id]){var e=_.extend({},t.line);this.lines[t.line.id]=e}this.data.transcript_id=t.transcript_id,this.data.flags=t.flags,this.data.flag_types=t.flag_types,this.data.line=this.lines[t.line.id],this.show()},render:function(){this.$el.html(this.template(this.data))},select:function(t){t.preventDefault();var e=this.$(".option"),i=$(t.currentTarget),n=parseInt(i.attr("type-id"));e.not('[type-id="'+n+'"]').removeClass("active").attr("aria-checked","false"),i.toggleClass("active");var r=0;i.hasClass("active")&&(i.attr("aria-checked","true"),r=n),this.data.line.user_flag.flag_type_id=r},show:function(){this.render(),PubSub.publish("modal.invoke",this.id)},submit:function(t){t&&t.preventDefault();var e=this;this.data.line.user_flag.text=this.$(".input-text").val(),this.lines[this.data.line.id]=_.extend({},this.data.line);var i={flag_type_id:this.data.line.user_flag.flag_type_id,text:this.data.line.user_flag.text,transcript_line_id:this.data.line.id,transcript_id:this.data.transcript_id};$.post(API_URL+"/flags.json",{flag:i},function(t){e.$(".message").addClass("active").html("<p>Thank you for flagging this line. We will be periodically reviewing and correcting flagged errors.</p>"),setTimeout(function(){PubSub.publish("modals.dismiss",!0)},3e3)})},togglePlay:function(t){t&&t.preventDefault(),PubSub.publish("player.toggle-play",!0)},viewFlags:function(t){t&&t.preventDefault(),this.$("footer .button, .flag-content").removeClass("active"),this.$(".view-add-flag, #flag-index").addClass("active")},viewForm:function(t){t&&t.preventDefault(),this.$("footer .button, .flag-content").removeClass("active"),this.$(".submit, .view-flags, #flag-add").addClass("active")}}),app.views.TranscriptItem=app.views.Base.extend({template:_.template(TEMPLATES["transcript_item.ejs"]),tagName:"a",className:"transcript-item",audioDelay:500,events:{"mouseover .item-image":"on","mouseout .item-image":"off"},initialize:function(t){this.data=_.extend({},t),this.transcript=this.data.transcript,this.timeout=!1,this.player=!1,this.player_enabled=PROJECT.previewAudioOnHover,this.render(),this.loadListeners()},audioInit:function(t){var e=this,n="<audio preload>";_.each(t,function(t){var e=t.substr(t.lastIndexOf(".")+1),i=e;"mp3"==e&&(i="mpeg"),n+='<source src="'+t+'" type="audio/'+i+'">'}),n+="</audio>";var i=$(n);this.$el.append(i),this.player=i[0],this.player.onwaiting=function(){e.$el.addClass("buffering")},this.player.ontimeupdate=function(){e.$el.removeClass("buffering"),e.queue_pause&&e.audioPause()}},audioPause:function(){this.player&&this.player.pause()},audioPlay:function(){if(!this.transcript.audio_urls.length)return!1;PubSub.publish("player.playing",this.transcript.id),this.player||this.audioInit(this.transcript.audio_urls),this.player.playing||this.queue_pause||this.player.play()},loadListeners:function(){var i=this;PubSub.subscribe("player.playing",function(t,e){i.transcript.id!=e&&i.off()})},off:function(t){if(!this.player_enabled)return!1;this.queue_pause=!0,this.timeout&&clearTimeout(this.timeout),this.audioPause()},on:function(t){if(!this.player_enabled)return!1;this.queue_pause=!1;var e=this;this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(function(){e.audioPlay()},this.audioDelay)},render:function(){var t=this.transcript,e=t.title;return t.collection_title&&(e=t.collection_title+": "+e),this.$el.attr("title",e),this.$el.attr("role","listitem"),this.$el.attr("href",t.path),this.$el.html(this.template(t)),this}}),app.views.TranscriptLine=app.views.Base.extend({template:_.template(TEMPLATES["transcript_line.ejs"]),events:{click:"select","click .star":"star","click .flag":"flag","click .resolve":"resolve","click .verify":"verify","click .speaker-option":"selectSpeaker"},initialize:function(t){this.data=_.extend({},t),this.line=this.data.line||{},this.edits=this.data.edits||[],this.speakers=this.data.speakers||[],this.flag_types=this.data.flag_types||[],this.flags=this.data.flags||[],this.flagsLoaded=!1,this.render()},flag:function(t){t&&(t.preventDefault(),$(t.currentTarget).addClass("active"));var e=this;if(this.select(),!this.flagsLoaded)return this.flagsLoaded=!0,this.loadFlags(function(){e.flag()}),!1;PubSub.publish("transcript.flags.load",{flags:this.flags,line:this.line,flag_types:this.flag_types,transcript_id:this.data.transcript_id})},loadEdits:function(e){var i=this;$.getJSON(API_URL+"/transcript_edits.json",{transcript_line_id:this.line.id},function(t){t.edits&&t.edits.length&&(i.edits=i.parseEdits(t.edits),e&&e())})},loadFlags:function(e){var i=this;$.getJSON(API_URL+"/flags.json",{transcript_line_id:this.line.id},function(t){i.flags=t.flags||[],e&&e()})},parseEdits:function(t){var i=this.line,n=[],r=[];return _.each(t,function(t,e){_.contains(r,t.text)||(i.user_text==t.text&&(t.active=!0),r.push(t.text),n.push(t))}),n},render:function(){this.$el.html(this.template(_.extend({},this.line,{speakers:this.speakers})))},resolve:function(t){t&&(t.preventDefault(),$(t.currentTarget).addClass("active")),$.post(API_URL+"/transcript_lines/"+this.line.id+"/resolve.json"),this.$(".button.flag").removeClass("active")},select:function(t){t&&t.preventDefault(),PubSub.publish("transcript.line.select",this.line),!t||$(t.currentTarget).hasClass("verify")||"reviewing"!=this.line.status.name||this.line.is_editable||this.verify()},selectSpeaker:function(t){t.preventDefault();var e=$(t.currentTarget),i=parseInt(e.attr("data-id")),n=this.line.speaker_id;if(this.$(".speaker-option").removeClass("selected").attr("aria-checked","false"),this.$(".speaker").removeClass("selected c0 c1 c2 c3 c4 c5 c6 c7"),i==n)this.line.speaker_id=0;else{var r=_.pluck(this.speakers,"id").indexOf(i);this.line.speaker_id=i,e.addClass("selected").attr("aria-checked","true"),this.$(".speaker").addClass("selected c"+r)}var s={transcript_id:this.data.transcript_id,transcript_line_id:this.line.id,speaker_id:this.line.speaker_id};$.post(API_URL+"/transcript_speaker_edits.json",{transcript_speaker_edit:s},function(t){})},star:function(t){t.preventDefault(),$(t.currentTarget).toggleClass("active")},verify:function(t){t&&t.preventDefault(),this.select();var e=this;if(!this.edits.length)return this.loadEdits(function(){e.verify()}),!1;PubSub.publish("transcript.edits.load",{edits:this.edits,line:this.line})}}),app.views.TranscriptUserProgress=app.views.Base.extend({template:_.template(TEMPLATES["transcript_user_progress.ejs"]),el:"#transcript-user-progress",events:{"click .progress-toggle":"toggle"},initialize:function(t){this.data={},this.lines=_.map(t.lines,function(t,e){return{index:e,id:t.id,sequence:t.sequence,edited:0<t.user_text.length}}),this.calculate(),this.render(),this.loadListeners()},calculate:function(){var t=this.lines.length,e=_.reduce(this.lines,function(t,e){return t+(e.edited?1:0)},0);this.data.lines_edited=e,this.data.percent_edited=0,(this.data.lines_available=0)<t&&(this.data.percent_edited=UTIL.round(e/t*100,1),this.data.lines_available=t)},loadListeners:function(){var i=this;PubSub.subscribe("transcript.edit.submit",function(t,e){i.onLineEdit(e.transcript_line_id)})},onLineEdit:function(e){if(!(this.data.lines_available<=0)){var t=_.find(this.lines,function(t){return t.id==e});t&&!t.edited&&(this.lines[t.index].edited=!0,this.calculate(),this.render()),1<=this.data.percent_edited&&PubSub.publish("transcript.finished",!0)}},render:function(){0<this.data.lines_edited&&this.$el.addClass("active"),this.$(".progress-content").html(this.template(this.data))},toggle:function(t){t.preventDefault(),this.$el.toggleClass("minimized")}}),app.views.TranscriptToolbar=app.views.Base.extend({template:_.template(TEMPLATES["transcript_toolbar.ejs"]),initialize:function(t){this.data=_.extend({},t),this.loadControls(),this.loadListeners(),this.loadMenu(),this.render()},loadControls:function(){var t=this.data.controls||this.data.project.controls;this.data.controls=_.map(t,_.clone),this.data.controls=_.map(this.data.controls,function(t){var e=t.key;return 0<=e.indexOf("[")&&0<=e.indexOf("]")?t.key=t.key.replace(/\[/g,'<span title="'+t.keyLabel+'">').replace(/\]/g,"</span>"):t.key='<span title="'+t.keyLabel+'">'+t.key+"</span>",t}),this.data.control_width_percent=1/this.data.controls.length*100},loadListeners:function(){var i=this;PubSub.subscribe("player.state.change",function(t,e){i.$el.attr("state",e)})},loadMenu:function(){var t=this.data.menu,e=this.data.project.menus;if(this.data.menu="",t&&e[t]&&e[t].length){var i=_.extend({},this.data,{tagName:"div",menu_key:"transcript_edit"}),n=new app.views.Menu(i);this.data.menu=n.toString()}},render:function(){this.$el.html(this.template(this.data))}}),app.views.TranscriptLineVerify=app.views.Base.extend({id:"transcript-line-verify",className:"modal-wrapper",template:_.template(TEMPLATES["transcript_line_verify.ejs"]),events:{"click .option":"select","click .submit":"submit","click .none-correct":"noneCorrect","click .toggle-play":"togglePlay"},initialize:function(t){var i=this;this.data=_.extend({},t),this.data.title=this.data.title||"Choose the best transcription",this.data.active=this.data.active||!1,PubSub.subscribe("transcript.edits.load",function(t,e){i.data.line=e.line,i.showEdits(e.edits)})},noneCorrect:function(t){t.preventDefault();var e=this,i=this.data.line;PubSub.publish("transcript.edit.delete",i),this.$el.find(".option").removeClass("active"),this.data.edits=_.map(this.data.edits,function(t){return t.active=!1,t}),setTimeout(function(){e.submit()},800)},render:function(){this.$el.html(this.template(this.data))},select:function(t){t.preventDefault();var e=this.data.line,i=this.$el.find(".option"),n=$(t.currentTarget),r=parseInt(n.attr("edit-id"));i.not('[edit-id="'+r+'"]').removeClass("active").attr("aria-checked","false"),n.toggleClass("active"),this.data.edits=_.map(this.data.edits,function(t){return t.active=!1,t.id==r&&n.hasClass("active")&&(t.active=!0),t}),n.hasClass("active")?(n.attr("aria-checked","true"),PubSub.publish("transcript.line.verify",{line:e,text:n.text()})):PubSub.publish("transcript.edit.delete",e)},showEdits:function(t){this.data.edits=t,this.render(),PubSub.publish("modal.invoke",this.id)},submit:function(t){t&&t.preventDefault(),PubSub.publish("transcript.line.submit",!0)},togglePlay:function(t){t&&t.preventDefault(),PubSub.publish("player.toggle-play",!0)}}),app.views.TranscriptEdit=app.views.Transcript.extend({template:_.template(TEMPLATES["transcript_edit.ejs"]),events:{"click #conventions-link":"showConventions"},initialize:function(t){this.data=t,this.loadTranscript(),this.listenForAuth()},finished:function(){this.$(".transcript-finished").addClass("disabled"),this.$(".show-when-finished").addClass("active"),$(window).trigger("scroll-to",[$("#completion-content"),100])},showConventions:function(){this.$(".conventions-page").toggleClass("active")},lineEditDelete:function(t){if(t<0)return!1;var e=$('.line[sequence="'+t+'"] .text-input').first();if(!e.length)return!1;var i=this.data.transcript.lines[t];e.val(i.display_text),e.attr("user-value",""),e.closest(".line").removeClass("user-edited"),this.submitEdit({transcript_id:this.data.transcript.id,transcript_line_id:i.id,text:"",is_deleted:1,is_new:!1})},lineSave:function(t){if(t<0)return!1;var e=$('.line[sequence="'+t+'"] .text-input').first();if(!e.length)return!1;var i=this.data.transcript.lines[t],n=e.val();if(n!=e.attr("user-value")&&i.is_editable){if(this.play_all&&i.display_text==n)return;var r=!e.closest(".line").hasClass("user-edited");e.attr("user-value",n),e.closest(".line").addClass("user-edited"),this.submitEdit({transcript_id:this.data.transcript.id,transcript_line_id:i.id,text:n,is_deleted:0,is_new:r})}},lineVerify:function(t){var e=t.line,i=t.text,n=$('.line[sequence="'+e.sequence+'"] .text-input').first();if(!n.length)return!1;var r=!n.closest(".line").hasClass("user-edited");n.val(i),n.attr("user-value",i),n.closest(".line").addClass("user-edited"),this.submitEdit({transcript_id:this.data.transcript.id,transcript_line_id:e.id,text:i,is_deleted:0,is_new:r})},loadAnalytics:function(){this.$el.on("click",".conventions-link",function(){ANALYTICS.event("transcript","invoke-conventions")}),this.$el.on("click",".tutorial-link",function(){ANALYTICS.event("transcript","invoke-tutorial")})},loadCompletionContent:function(){if(this.data.completion_content="",this.data.project.pages["transcript_finished.md"]){var t=new app.views.Page(_.extend({},{project:this.data.project,page_key:"transcript_finished.md"}));this.data.completion_content=t.toString()}},loadConventions:function(){this.data.page_conventions=this.data.transcript.conventions},loadListeners:function(){var n=this,r=this.data.project.controls;$(".control").on("click.transcript",function(t){t.preventDefault();var e=$(this);_.each(r,function(t){e.hasClass(t.id)&&n[t.action]()})}),$(window).on("keydown.transcript",function(i){_.each(r,function(t){var e=[t.keyCode];if(t.keyCode.constructor===Array&&(e=t.keyCode),0<=e.indexOf(i.keyCode)&&(t.shift&&i.shiftKey||!t.shift))return i.preventDefault(),n[t.action]&&n[t.action](),!1})}),PubSub.subscribe("transcript.line.select",function(t,e){n.lineSelect(e.sequence)}),PubSub.subscribe("transcript.line.submit",function(t,e){n.lineSubmit()}),PubSub.subscribe("transcript.line.verify",function(t,e){n.lineVerify(e)}),PubSub.subscribe("transcript.edit.delete",function(t,e){n.lineEditDelete(e.sequence)}),PubSub.subscribe("transcript.finished",function(t){n.onTranscriptFinished()}),PubSub.subscribe("player.toggle-play",function(t,e){n.lineToggle()}),this.$el.on("click.transcript",".start-play",function(t){t.preventDefault(),n.start()}),this.$el.on("click.transcript",".transcript-finished",function(t){t.preventDefault(),n.finished()}),this.$el.on("click.transcript",".play-all",function(t){t.preventDefault(),n.playAll()}),this.loadAnalytics()},loadPageContent:function(){if(this.data.page_content="",this.data.project.pages["transcript_edit.md"]){var t=new app.views.Page(_.extend({},{transcript:this.data.transcript,project:this.data.project,page_key:"transcript_edit.md"}));this.data.page_content=t.toString()}},loadTutorial:function(){var t=this.data.project.modals.tutorial_edit;!t||"always"!=t.displayMethod&&$.cookie("tutorial_edit-tutorial")||(PubSub.publish("modal.invoke","tutorial_edit"),$.cookie("tutorial_edit-tutorial",1))},loadUserProgress:function(){var t=_.filter(this.data.transcript.lines,function(t){return t.is_available}),e=new app.views.TranscriptUserProgress({lines:t});this.$("#transcript-user-progress").append(e.$el)},onAudioLoad:function(){this.data.debug&&console.log("Loaded audio files"),this.render(),this.$el.removeClass("loading"),this.$(".start-play, .play-all").removeClass("disabled"),this.loadListeners(),this.message("Loaded transcript"),this.loaded||(this.loaded=!0),this.queue_start&&this.start(),this.queue_start=!1,this.checkForStartTime()},onTranscriptFinished:function(){this.$(".completion-content").addClass("active")},onTranscriptLoad:function(t){this.data.debug&&console.log("Transcript",t.toJSON()),PubSub.publish("transcript.load",{transcript:t.toJSON(),action:"edit",label:t.get("title")}),this.data.transcript=t.toJSON(),this.parseTranscript(),this.loadPageContent(),this.loadCompletionContent(),this.loadConventions(),this.loadAudio()},onTimeUpdate:function(){this.player.playing&&this.playerState("playing"),void 0!==this.pause_at_time&&this.player.currentTime>=this.pause_at_time&&this.playerPause({trigger:"end_of_line"})},selectTextRange:function(t){var e=$(".line.active input").first();if(!e.length)return!1;var i=e[0],n=i.value.replace(/\s{2,}/g," ").trim(),r=n.split(/\ +/),s=0,a=0;if(n.length!=i.value.length){var o=e.getInputSelection().start;e.val(n),e.setInputPosition(o)}var c=e.getInputSelection(),l=n.substring(0,c.start).split(/\ +/).length-2;c.end>c.start?l++:(t<0&&(l+=2),c.start<=0||" "==n.charAt(c.start-1)?t<0&&l--:(c.start>=n.length-1||" "==n.charAt(c.start))&&0<t&&l++),(l+=t)>=r.length&&(l=0),l<0&&(l=r.length-1),$.each(r,function(t,e){if(t==l)return a=s+e.length,!1;s+=e.length+1}),i.setSelectionRange&&i.setSelectionRange(s,a)},wordPrevious:function(){this.selectTextRange(-1)},wordNext:function(){this.selectTextRange(1)}}),app.views.TranscriptsIndex=app.views.Base.extend({template:_.template(TEMPLATES["transcript_index.ejs"]),template_list:_.template(TEMPLATES["transcript_list.ejs"]),template_item:_.template(TEMPLATES["transcript_item.ejs"]),className:"transcripts-wrapper",events:{"click .list-next":"nextPage"},initialize:function(t){this.data=t,this.render(),this.$transcripts=this.$("#transcript-results"),this.$facets=this.$("#transcript-facets"),this.transcripts=[],this.defaultSortName=null,this.defaultSortOrder=null,Amplify.getConfig("homepage.search.sort_options.active_sort")&&(this.sortName=this.defaultSortName=Amplify.getConfig("homepage.search.sort_options.active_sort")),Amplify.getConfig("homepage.search.sort_options.active_order")&&(this.sortOrder=this.defaultSortOrder=Amplify.getConfig("homepage.search.sort_options.active_order")),this.data.queryParams&&this.loadParams(this.data.queryParams),this.loadTranscripts(),this.loadCollections(),this.loadListeners()},addList:function(t){this.transcripts=this.transcripts.concat(t.toJSON()),this.isFaceted()?this.facet():(this.defaultSortName&&(this.transcripts=this.sortTranscripts(this.transcripts,this.defaultSortName,this.defaultSortOrder)),this.addListToUI(this.transcripts,t.hasMorePages(),!0,1<t.getPage()))},addListToUI:function(t,e,i,n){var r=this.template_list({has_more:e}),s=$(r),a=s.first();i?this.$transcripts.append(s):(this.$transcripts.empty(),t.length?this.$transcripts.html(s):this.$transcripts.html("<p>No transcripts found!</p>")),this.$transcripts.removeClass("loading"),_.each(t,function(t){var e=new app.views.TranscriptItem({transcript:t});a.append(e.$el)}),n&&$(window).trigger("scroll-to",[s,110])},facet:function(){this.collection.hasAllPages()?this.facetOnClient():this.facetOnServer()},sortTranscripts:function(e,i,t){var n=_.sortByNat(e,function(t){return"random"==i?Math.floor(Math.random()*e.length):t[i]});return"desc"==t.toLowerCase()&&(n=n.reverse()),n},facetOnClient:function(){var t=this.filters||{},e=this.searchKeyword||"",n=_.map(this.transcripts,_.clone);if(_.each(t,function(e,i){n=_.filter(n,function(t){return!_.has(t,i)||t[i]==e})}),e.length){var i=new Fuse(n,{keys:["title","description"],threshold:.2});n=_.union(_.filter(n,function(t){return 0<=t.title.toLowerCase().indexOf(e.toLowerCase())||0<=t.description.toLowerCase().indexOf(e.toLowerCase())}),i.search(e))}this.sortName&&(n=this.sortTranscripts(n,this.sortName,this.sortOrder)),this.renderTranscripts(n)},facetOnServer:function(){this.facetOnClient()},filterBy:function(t,e){this.filters=this.filters||{},this.filters[t]=e,this.filters=_.omit(this.filters,function(t,e){return"ALL"==t}),this.facet(),this.updateUrlParams()},isFaceted:function(){return this.filters||!!this.sortName&&this.sortName!=this.defaultSortName||!!this.sortOrder&&this.sortOrder!=this.defaultSortOrder||this.searchKeyword},loadCollections:function(){var n=this;this.collections=this.collections||this.data.collections,this.collections.fetch({success:function(t,e,i){n.renderFacets(t.toJSON())},error:function(t,e,i){n.renderFacets([])}})},loadListeners:function(){var i=this;PubSub.subscribe("transcripts.filter",function(t,e){i.filterBy(e.name,e.value)}),PubSub.subscribe("transcripts.sort",function(t,e){i.sortBy(e.name,e.order)}),PubSub.subscribe("transcripts.search",function(t,e){i.search(e)})},loadParams:function(t){var i=this;this.filters=this.filters||{},_.each(t,function(t,e){"sort_by"==e?i.sortName=t:"order"==e?i.sortOrder=t:"keyword"==e?i.searchKeyword=t:i.filters[e]=t})},loadTranscripts:function(){var n=this;this.$transcripts.addClass("loading"),this.collection.fetch({success:function(t,e,i){n.addList(t)},error:function(t,e,i){$(window).trigger("alert",["Whoops! We seem to have trouble loading our transcripts. Please try again by refreshing your browser or come back later!"])}})},nextPage:function(t){t.preventDefault(),$(t.currentTarget).remove(),this.collection.nextPage(),this.loadTranscripts()},render:function(){return this.$el.attr("role","main"),this.$el.html(this.template(this.data)),this},renderFacets:function(t){this.facetsView=this.facetsView||new app.views.TranscriptFacets({collections:t,queryParams:this.data.queryParams}),this.$facets.html(this.facetsView.render().$el)},renderTranscripts:function(t){this.addListToUI(t,!1,!1,!0)},search:function(t){this.searchKeyword=t,this.facet()},sortBy:function(t,e){this.sortName=t,this.sortOrder=e,this.facet(),this.updateUrlParams()},updateUrlParams:function(){var i={};if(this.sortName&&this.sortOrder&&(i.sort_by=this.sortName,i.order=this.sortOrder),this.filters&&_.each(this.filters,function(t,e){i[e]=t}),0<_.keys(i).length&&window.history){var t="/"+this.data.route.route+"?"+$.param(i);window.history.pushState(i,document.title,t)}else if(window.history){t="/"+this.data.route.route;window.history.pushState(i,document.title,t)}}});